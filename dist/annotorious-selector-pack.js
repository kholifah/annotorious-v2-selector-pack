!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SelectorPack=e():t.SelectorPack=e()}(this,(()=>(()=>{var t={17:t=>{"use strict";t.exports=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;var s,n,r;if(Array.isArray(e)){if((s=e.length)!=i.length)return!1;for(n=s;0!=n--;)if(!t(e[n],i[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if((s=(r=Object.keys(e)).length)!==Object.keys(i).length)return!1;for(n=s;0!=n--;)if(!Object.prototype.hasOwnProperty.call(i,r[n]))return!1;for(n=s;0!=n--;){var o=r[n];if(!t(e[o],i[o]))return!1}return!0}return e!=e&&i!=i}},56:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var r={},o=[],a=0;a<t.length;a++){var h=t[a],l=s.base?h[0]+s.base:h[0],u=r[l]||0,c="".concat(l," ").concat(u);r[l]=u+1;var d=i(c),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var b=n(p,s);s.byIndex=a,e.splice(a,0,{identifier:c,updater:b,references:1})}o.push(c)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var r=s(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<r.length;o++){var a=i(r[o]);e[a].references--}for(var h=s(t,n),l=0;l<r.length;l++){var u=i(r[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=h}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},285:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var s=i(601),n=i.n(s),r=i(314),o=i.n(r)()(n());o.push([t.id,".a9s-selection.improved-polygon .a9s-rubberband{fill:hsla(0,0%,100%,.15);stroke-width:1px;stroke:rgba(0,0,0,.3)}.a9s-selection.improved-polygon .a9s-inner,.a9s-annotation.improved-polygon.editable .a9s-inner{stroke-width:2px;stroke:#fff;stroke-dasharray:5 3}.a9s-annotation.improved-polygon.editable .a9s-inner:hover{fill:rgba(0,0,0,0)}.a9s-selection.improved-polygon .a9s-outer,.a9s-annotation.improved-polygon.editable .a9s-outer{stroke-width:4px;stroke:rgba(0,0,0,.35)}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer{stroke-width:1;stroke:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner{stroke-width:2;stroke:#fff;fill:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover{fill:#fff;color:green}.selectedCorner{fill:#fff !important}.selectedCorner .a9s-handle-inner{fill:#fff !important;color:green}.a9s-annotation.improved-polygon.editable .a9s-midpoint{display:none;fill:hsla(0,0%,100%,.65);stroke-width:1;stroke:rgba(0,0,0,.65)}.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint{display:block}.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover{fill:#fff}",""]);const a=o},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);s&&o[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),e.push(u))}},e}},504:t=>{function e(){}e.prototype={on:function(t,e,i){var s=this.e||(this.e={});return(s[t]||(s[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var s=this;function n(){s.off(t,n),e.apply(i,arguments)}return n._=e,this.on(t,n,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),s=0,n=i.length;s<n;s++)i[s].fn.apply(i[s].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),s=i[t],n=[];if(s&&e)for(var r=0,o=s.length;r<o;r++)s[r].fn!==e&&s[r].fn._!==e&&n.push(s[r]);return n.length?i[t]=n:delete i[t],this}},t.exports=e,t.exports.TinyEmitter=e},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},659:t=>{"use strict";var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0;var s={};return(()=>{"use strict";i.r(s),i.d(s,{default:()=>ie});var t=i(504),e=i.n(t);const n="http://www.w3.org/2000/svg",r=t=>{const e=t.getAttribute("class");return e?new Set(e.split(" ")):new Set},o=(t,e)=>{const i=r(t);i.add(e),t.setAttribute("class",Array.from(i).join(" "))},a=(t,e)=>{const i=r(t);i.delete(e),0===i.size?t.removeAttribute("class"):t.setAttribute("class",Array.from(i).join(" "))},h=(t,e)=>r(t).has(e);var l,u=new Uint8Array(16);function c(){if(!l&&!(l="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(u)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var p=[],b=0;b<256;++b)p.push((b+256).toString(16).substr(1));const g=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(p[t[e+0]]+p[t[e+1]]+p[t[e+2]]+p[t[e+3]]+"-"+p[t[e+4]]+p[t[e+5]]+"-"+p[t[e+6]]+p[t[e+7]]+"-"+p[t[e+8]]+p[t[e+9]]+"-"+p[t[e+10]]+p[t[e+11]]+p[t[e+12]]+p[t[e+13]]+p[t[e+14]]+p[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&d.test(t)}(i))throw TypeError("Stringified UUID is invalid");return i},m=function(t,e,i){var s=(t=t||{}).random||(t.rng||c)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var n=0;n<16;++n)e[i+n]=s[n];return e}return g(s)};var f=i(17),y=i.n(f);class v{constructor(t,e){this.underlying=t,this.opts=e}static create=t=>{const e={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:`#${m()}`,body:[]};return new v({...e,...t})};clone=(t,e)=>new v({...this.underlying,...t},{...this.opts,...e});isEqual(t){return"Annotation"===t?.type&&(this.underlying===t.underlying||!(!this.underlying.id||!t.underlying.id)&&y()(this.underlying,t.underlying))}get readOnly(){return this.opts?.readOnly}get id(){return this.underlying.id}get context(){return this.underlying["@context"]}get type(){return this.underlying.type}get motivation(){return this.underlying.motivation}get body(){return this.underlying.body}get target(){return this.underlying.target}get bodies(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}set bodies(t){this.underlying.body=t}get targets(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}selector=t=>{const{target:e}=this.underlying;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((e=>e.type===t))};get quote(){return this.selector("TextQuoteSelector")?.exact}get start(){return this.selector("TextPositionSelector")?.start}get end(){return this.selector("TextPositionSelector")?.end}}class w{constructor(t,e){this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:e||[],target:t}}clone=t=>{const e=new w;return e.underlying=JSON.parse(JSON.stringify(this.underlying)),t&&(e.underlying={...e.underlying,...t}),e};get context(){return this.underlying["@context"]}get type(){return this.underlying.type}get body(){return this.underlying.body}get target(){return this.underlying.target}get targets(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}isEqual(t){return!!t&&y()(this.underlying,t.underlying)}get bodies(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}selector=t=>{const{target:e}=this.underlying;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((e=>e.type===t))};get quote(){return this.selector("TextQuoteSelector")?.exact}get isSelection(){return!0}toAnnotation=()=>{const t=Object.assign({},this.underlying,{type:"Annotation",id:`#${m()}`});return new v(t)}}const S="An implementation is missing",x="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;class A extends(e()){constructor(t,e,i){super(),this.svg=t.closest("svg"),this.g=t,this.config=e,this.env=i,this.scale=1;const{image:s}=i;(s instanceof Element||s instanceof HTMLDocument)&&this.enableResponsive()}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}enableResponsive=()=>{window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((()=>{const t=this.svg.getBoundingClientRect(),{width:e,height:i}=this.svg.viewBox.baseVal;this.scale=Math.max(e/t.width,i/t.height),this.onScaleChanged&&this.onScaleChanged(this.scale)})),this.resizeObserver.observe(this.svg.parentNode))};getSVGPoint=t=>{const e=this.svg.createSVGPoint();if(x){const i=this.svg.getBoundingClientRect(),s=t.clientX-i.x,n=t.clientY-i.y,{left:r,top:o}=this.svg.getBoundingClientRect();return e.x=s+r,e.y=n+o,e.matrixTransform(this.g.getScreenCTM().inverse())}return e.x=t.offsetX,e.y=t.offsetY,e.matrixTransform(this.g.getCTM().inverse())};drawHandle=(t,e)=>{const i=document.createElementNS(n,"g");i.setAttribute("class","a9s-handle");const s=document.createElementNS(n,"g"),r=i=>{const s=document.createElementNS(n,"circle");return s.setAttribute("cx",t),s.setAttribute("cy",e),s.setAttribute("r",i),s.setAttribute("transform-origin",`${t} ${e}`),s},o=this.config.handleRadius||6,a=r(o);a.setAttribute("class","a9s-handle-inner");const h=r(o+1);return h.setAttribute("class","a9s-handle-outer"),s.appendChild(h),s.appendChild(a),i.appendChild(s),i};setHandleXY=(t,e,i)=>{const s=t.querySelector(".a9s-handle-inner");s.setAttribute("cx",e),s.setAttribute("cy",i),s.setAttribute("transform-origin",`${e} ${i}`);const n=t.querySelector(".a9s-handle-outer");n.setAttribute("cx",e),n.setAttribute("cy",i),n.setAttribute("transform-origin",`${e} ${i}`)};getHandleXY=t=>{const e=t.querySelector(".a9s-handle-outer");return{x:parseFloat(e.getAttribute("cx")),y:parseFloat(e.getAttribute("cy"))}};scaleHandle=t=>{const e=t.querySelector(".a9s-handle-inner"),i=t.querySelector(".a9s-handle-outer"),s=this.scale*(this.config.handleRadius||6);e.setAttribute("r",s),i.setAttribute("r",s)}}class E extends A{constructor(t,e,i){super(t,e,i),this.started=!1}attachListeners=({mouseMove:t,mouseUp:e,dblClick:i})=>{t&&(this.mouseMove=e=>{const{x:i,y:s}=this.getSVGPoint(e);this.started||(this.emit("startSelection",{x:i,y:s}),this.started=!0),t(i,s,e)},this.svg.addEventListener("mousemove",this.mouseMove)),e&&(this.mouseUp=t=>{if(0!==t.button)return;const{x:i,y:s}=this.getSVGPoint(t);e(i,s,t)},document.addEventListener("mouseup",this.mouseUp)),i&&(this.dblClick=t=>{const{x:e,y:s}=this.getSVGPoint(t);i(e,s,t)},document.addEventListener("dblclick",this.dblClick))};detachListeners=()=>{this.mouseMove&&this.svg.removeEventListener("mousemove",this.mouseMove),this.mouseUp&&document.removeEventListener("mouseup",this.mouseUp),this.dblClick&&document.removeEventListener("dblclick",this.dblClick)};start=(t,e)=>{const{x:i,y:s}=this.getSVGPoint(t),{naturalWidth:n,naturalHeight:r}=this.env.image,o=i<0?0:i>n?n:i,a=s<0?0:s>r?r:s;this.startDrawing(o,a,e,t)};get isDrawing(){throw new Error(S)}startDrawing=t=>{throw new Error(S)};createEditableShape=(t,e)=>{throw new Error(S)}}E.supports=t=>{throw new Error(S)};const C="An implementation is missing";class M extends A{constructor(t,e,i,s){super(e,i,s),this.annotation=t}get element(){throw new Error(C)}updateState=t=>{throw new Error(C)}}const P=(t,e)=>{const i=t.selector("FragmentSelector");if(i?.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){const{value:t}=i,s=t.includes(":")?t.substring(t.indexOf("=")+1,t.indexOf(":")):"pixel",n=t.includes(":")?t.substring(t.indexOf(":")+1):t.substring(t.indexOf("=")+1);let[r,o,a,h]=n.split(",").map(parseFloat);return"percent"===s.toLowerCase()&&(r=r*e.naturalWidth/100,o=o*e.naturalHeight/100,a=a*e.naturalWidth/100,h=h*e.naturalHeight/100),{x:r,y:o,w:a,h}}},G=(t,e,i,s,n,r)=>"percent"===r?.toLowerCase()?((t,e,i,s,n)=>{const r=t/n.naturalWidth*100,o=e/n.naturalHeight*100,a=i/n.naturalWidth*100,h=s/n.naturalHeight*100;return{source:n.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=percent:${r},${o},${a},${h}`}}})(t,e,i,s,n):((t,e,i,s,n)=>({source:n?.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=pixel:${t},${e},${i},${s}`}}))(t,e,i,s,n),k=(t,e,i,s)=>({...G(t,e,0,0,i,s),renderedVia:{name:"point"}});function H(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class N extends M{constructor(t,e,i,s){super(t,e,i,s),H(this,"onScaleChanged",(()=>this.scaleHandle(this.point))),H(this,"onGrab",(()=>{this.isGrabbed=!0})),H(this,"onMouseMove",(t=>{if(0===t.button&&this.isGrabbed){const{x:e,y:i}=this.getSVGPoint(t);this.setHandleXY(this.point,e,i);const s=k(e,i,this.env.image,this.config.fragmentUnit);this.emit("update",s)}})),H(this,"onMouseUp",(()=>{this.isGrabbed=!1})),H(this,"updateState",(t=>{const{x:e,y:i}=P(t,this.env.image);this.setHandleXY(this.point,e,i)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp);const{x:r,y:o}=P(t,s.image);this.container=document.createElementNS(n,"g"),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.point=this.drawHandle(r,o),this.point.addEventListener("mousedown",this.onGrab),this.elementGroup.appendChild(this.point),this.container.appendChild(this.elementGroup),e.appendChild(this.container),this.isGrabbed=!1}get element(){return this.elementGroup}destroy(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),super.destroy()}}function j(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class L extends E{constructor(t,e,i){super(t,e,i),j(this,"startDrawing",((t,e,i,s)=>{const n=s.target.closest(".a9s-annotation")?.annotation;if(n&&(t=>"point"===t.target.renderedVia?.name)(n))this.emit("cancel");else{const i=this.drawHandle(t,e);this.scaleHandle(i),this.g.appendChild(i),i.annotation=new w(k(t,e,this.env.image,this.config.fragmentUnit)),this.emit("complete",i)}})),j(this,"stop",(()=>{})),j(this,"createEditableShape",(t=>new N(t,this.g,this.config,this.env)))}get isDrawing(){return!1}}L.identifier="point",L.supports=t=>!1;const T=t=>{const e=t=>{Array.from(t.attributes).forEach((e=>{e.name.startsWith("on")&&t.removeAttribute(e.name)}))},i=t.getElementsByTagName("script");return Array.from(i).reverse().forEach((t=>t.parentNode.removeChild(t))),e(t),Array.from(t.querySelectorAll("*")).forEach(e),t},$=t=>{const e=t.selector("SvgSelector");if(e){const t=new DOMParser,{value:i}=e,s=t.parseFromString(i,"image/svg+xml"),r=s.lookupPrefix(n),o=s.lookupNamespaceURI(null);return r||o?T(s).firstChild:T((t=>{const e=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",`<svg xmlns="${n}">`);return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement})(s)).firstChild}},O=t=>{const e=$(t),i=document.createElementNS(n,"g"),s=e.cloneNode(!0);s.setAttribute("class","a9s-inner");const r=e.cloneNode(!0);return r.setAttribute("class","a9s-outer"),i.appendChild(r),i.appendChild(s),i},D=(t,e)=>{const i=t.querySelector(".a9s-inner").cloneNode(!0);i.removeAttribute("class"),i.removeAttribute("xmlns");let s=i.outerHTML||(new XMLSerializer).serializeToString(i);return s=s.replace(` xmlns="${n}"`,""),{source:e?.src,selector:{type:"SvgSelector",value:`<svg>${s}</svg>`}}},U=(t,e,i,s)=>{t.setAttribute("cx",e),t.setAttribute("cy",i),t.setAttribute("r",s)},q=(t,e,i,s)=>{const n=t.querySelector(".a9s-inner"),r=t.querySelector(".a9s-outer");U(n,e,i,s),U(r,e,i,s)},X=t=>{const e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),r:parseFloat(e.getAttribute("r"))}};function R(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Y{constructor(t,e){R(this,"redraw",(()=>{const{cx:t,cy:e,r:i}=X(this.circle),s=t+i>this.w?this.w-i:t,n=e+i>this.h?this.h-i:e+i;this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${s} ${n} a ${i} ${i} 0 1 1 1 0`)})),R(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=e;const{cx:i,cy:s,r}=X(this.circle),o=i+r>this.w?this.w-r:i,a=s+r>this.h?this.h-r:s+r;this.mask=document.createElementNS(n,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${o} ${a} a ${r} ${r} 0 1 1 1 0`)}get element(){return this.mask}}function F(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class B{constructor(t,e,i,s){F(this,"dragTo",((t,e)=>{const{naturalWidth:i,naturalHeight:s}=this.env.image;this.group.style.display=null;const n=t-this.anchor[0],r=e-this.anchor[1],o=Math.max(1,Math.pow(n**2+r**2,.5)/2),a=this.anchor[0]+n/2,h=this.anchor[1]+r/2;a-o<0||a+o>i||h-o<0||h+o>s||(q(this.circle,a,h,o),this.mask.redraw())})),F(this,"getBoundingClientRect",(()=>this.circle.getBoundingClientRect())),F(this,"toSelection",(()=>new w(D(this.group,this.env.image)))),F(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.mask=null,this.circle=null,this.group=null})),this.anchor=[t,e],this.env=s,this.group=document.createElementNS(n,"g"),this.circle=((t,e)=>{const i=document.createElementNS(n,"g"),s=document.createElementNS(n,"circle"),r=document.createElementNS(n,"circle");return r.setAttribute("class","a9s-inner"),U(r,t,e,2),s.setAttribute("class","a9s-outer"),U(s,t,e,2),i.appendChild(s),i.appendChild(r),i})(t,e),this.circle.setAttribute("class","a9s-selection"),this.mask=new Y(s.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),i.appendChild(this.group)}get element(){return this.circle}}const V=/firefox/i.test(navigator.userAgent),z=(t,e,i,s,n)=>{t.setAttribute("width",s),t.setAttribute("height",n),V?(t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("transform",`translate(${e}, ${i})`)):(t.setAttribute("x",e),t.setAttribute("y",i))},_=(t,e,i)=>{if(!i)return t;const s=i.reduce(((t,i)=>{const s=i(e);if(!s)return t;if("string"==typeof s||s instanceof String)t.className=t.className?`${t.className} ${s}`:s;else if(s.nodeType===Node.ELEMENT_NODE)t.elements=t.elements?[...t.elements,s]:[s];else{const{className:e,style:i,element:n}=s;e&&(t.className=t.className?`${t.className} ${e}`:e),i&&(t.style=t.style?`${t.style} ${i}`:i),n&&(t.elements=t.elements?[...t.elements,n]:[n])}for(const e in s)s.hasOwnProperty(e)&&e.startsWith("data-")&&(t[e]=s[e]);return t}),{}),{className:r,style:a,elements:h}=s;if(r&&o(t,r),a){const e=t.querySelector(".a9s-outer"),i=t.querySelector(".a9s-inner");e&&i?(e.setAttribute("style","display:none"),i.setAttribute("style",a)):t.setAttribute("style",a)}h&&h.forEach((e=>((t,e)=>{const{x:i,y:s,width:r,height:o}=e.getBBox(),a=document.createElementNS(n,"svg");a.setAttribute("class","a9s-formatter-el"),z(a,i,s,r,o);const h=document.createElementNS(n,"g");h.appendChild(t),a.appendChild(h),e.append(a)})(e,t)));for(const e in s)s.hasOwnProperty(e)&&e.startsWith("data-")&&t.setAttribute(e,s[e])},W=(t,e,i,s,n)=>{const r=t.querySelector(".a9s-formatter-el");r&&z(r,e,i,s,n)};function K(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class I extends M{constructor(t,e,i,s){super(t,e,i,s),K(this,"setSize",((t,e,i)=>{q(this.circle,t,e,i),this.mask.redraw(),W(this.elementGroup,t,e,i,i);const[s,n,r,o]=this.handles;this.setHandleXY(s,t,e-i),this.setHandleXY(n,t+i,e),this.setHandleXY(r,t,e+i),this.setHandleXY(o,t-i,e)})),K(this,"stretchCorners",((t,e,i)=>{const s=this.getHandleXY(e);var n,r=i.x,o=i.y,a=0,h=0;0==t||2==t?(r=s.x,h=o-s.y,n=Math.abs(h)/2):(o=s.y,a=r-s.x,n=Math.abs(a)/2);const l=a>0?s.x:r,u=h>0?s.y:o,c=l+Math.abs(a)/2,d=u+Math.abs(h)/2;if(q(this.circle,c,d,n),this.mask.redraw(),W(this.elementGroup,c,d,n,n),0==t||2==t){var p=0,b=2;(0==t&&h>0||2==t&&h<0)&&(p=2,b=0),this.setHandleXY(this.handles[p],c,d-n),this.setHandleXY(this.handles[b],c,d+n),this.setHandleXY(this.handles[1],c+n,d),this.setHandleXY(this.handles[3],c-n,d)}else{var g=3,m=1;(1==t&&a>0||3==t&&a<0)&&(g=1,m=3),this.setHandleXY(this.handles[g],c+n,d),this.setHandleXY(this.handles[m],c-n,d),this.setHandleXY(this.handles[0],c,d-n),this.setHandleXY(this.handles[2],c,d+n)}})),K(this,"onGrab",(t=>e=>{this.grabbedElem=t;const i=this.getSVGPoint(e),{cx:s,cy:n}=X(this.circle);this.grabbedAt={x:i.x-s,y:i.y-n}})),K(this,"onMouseMove",(t=>{const e=(t,e)=>t<0?0:t>e?e:t;if(this.grabbedElem){const i=this.getSVGPoint(t);if(this.grabbedElem===this.circle){const{r:t}=X(this.circle),{naturalWidth:s,naturalHeight:n}=this.env.image,r=Math.max(e(i.x-this.grabbedAt.x,s-t),t),o=Math.max(e(i.y-this.grabbedAt.y,n-t),t);this.setSize(r,o,t),this.emit("update",D(this.circle,this.env.image))}else{const t=this.handles.indexOf(this.grabbedElem),e=t<2?this.handles[t+2]:this.handles[t-2];this.stretchCorners(t,e,i),this.emit("update",D(this.circle,this.env.image))}}})),K(this,"onMouseUp",(()=>{this.grabbedElem=null,this.grabbedAt=null})),K(this,"onScaleChanged",(t=>this.handles.map(this.scaleHandle))),K(this,"updateState",(t=>{const e=$(t),i=parseFloat(e.getAttribute("cx")),s=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("r"));this.setSize(i,s,n)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(n,"g"),this.circle=O(t),this.circle.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.circle)),this.mask=new Y(s.image,this.circle),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.circle);const{cx:r,cy:o,r:a}=X(this.circle);this.handles=[[r,o-a],[r+a,o],[r,o+a],[r-a,o]].map((t=>{const[e,i]=t,s=this.drawHandle(e,i);return s.addEventListener("mousedown",this.onGrab(s)),this.elementGroup.appendChild(s),s})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),_(this.circle,t,i.formatter),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}destroy(){this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()}}function Z(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class J extends E{constructor(t,e,i){super(t,e,i),Z(this,"startDrawing",((t,e)=>{this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new B(t,e,this.g,this.env)})),Z(this,"stop",(()=>{this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),Z(this,"onMouseMove",((t,e)=>this.rubberband.dragTo(t,e))),Z(this,"onMouseUp",(()=>{this.detachListeners(),this.started=!1;const{width:t,height:e}=this.rubberband.getBoundingClientRect(),i=this.config.minSelectionWidth||4,s=this.config.minSelectionHeight||4;if(t>=i&&e>=s){const{element:t}=this.rubberband;t.annotation=this.rubberband.toSelection(),this.emit("complete",t)}else this.emit("cancel");this.stop()})),Z(this,"createEditableShape",(t=>new I(t,this.g,this.config,this.env))),this.rubberband=null}get isDrawing(){return null!=this.rubberband}}J.identifier="circle",J.supports=t=>{const e=t.selector("SvgSelector");if(e)return e.value?.match(/^<svg.*<circle/g)};const Q=(t,e,i,s,n)=>{t.setAttribute("cx",e),t.setAttribute("cy",i),t.setAttribute("rx",s),t.setAttribute("ry",n)},tt=(t,e,i,s,n)=>{const r=t.querySelector(".a9s-inner"),o=t.querySelector(".a9s-outer");Q(r,e,i,s,n),Q(o,e,i,s,n)},et=t=>{const e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),rx:parseFloat(e.getAttribute("rx")),ry:parseFloat(e.getAttribute("ry"))}};function it(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class st{constructor(t,e){it(this,"redraw",(()=>{const{cx:t,cy:e,rx:i,ry:s}=et(this.ellipse),n=e+s;this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${t} ${n} a ${i} ${s} 0 1 1 1 0`)})),it(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=e;const{cx:i,cy:s,rx:r,ry:o}=et(this.ellipse),a=s+o;this.mask=document.createElementNS(n,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${i} ${a} a ${r} ${o} 0 1 1 1 0`)}get element(){return this.mask}}function nt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class rt{constructor(t,e,i,s){nt(this,"dragTo",((t,e)=>{this.group.style.display=null;const i=t-this.anchor[0],s=e-this.anchor[1],n=i>0?this.anchor[0]+i/2:t+i/2,r=s>0?this.anchor[1]+s/2:e+s/2,o=Math.abs(i/2),a=Math.abs(s/2);tt(this.ellipse,n,r,o,a),this.mask.redraw()})),nt(this,"getBoundingClientRect",(()=>this.ellipse.getBoundingClientRect())),nt(this,"toSelection",(()=>new w(D(this.group,this.env.image)))),nt(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.mask=null,this.ellipse=null,this.group=null})),this.anchor=[t,e],this.env=s,this.group=document.createElementNS(n,"g"),this.ellipse=((t,e)=>{const i=document.createElementNS(n,"g"),s=document.createElementNS(n,"ellipse"),r=document.createElementNS(n,"ellipse");return s.setAttribute("class","a9s-inner"),Q(s,t,e,2,2),r.setAttribute("class","a9s-outer"),Q(r,t,e,2,2),i.appendChild(r),i.appendChild(s),i})(t,e),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new st(s.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),i.appendChild(this.group)}get element(){return this.ellipse}}function ot(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class at extends M{constructor(t,e,i,s){super(t,e,i,s),ot(this,"setSize",((t,e,i,s)=>{tt(this.ellipse,t,e,i,s),this.mask.redraw(),W(this.elementGroup,t,e,i,s);const[n,r,o,a]=this.handles;this.setHandleXY(n,t,e-s),this.setHandleXY(r,t+i,e),this.setHandleXY(o,t,e+s),this.setHandleXY(a,t-i,e)})),ot(this,"stretchCorners",((t,e,i,s)=>{const n=this.getHandleXY(e),r=this.getHandleXY(i);var o=s.x,a=s.y,h=0,l=0;0==t||2==t?o=n.x:a=n.y;const u=o-n.x,c=a-n.y,d=u>0?n.x:o,p=c>0?n.y:a,b=Math.abs(u),g=Math.abs(c),m=d+b/2,f=p+g/2;if(h=b/2,l=g/2,0==t||2==t?h=Math.abs(n.x-r.x):l=Math.abs(n.y-r.y),tt(this.ellipse,m,f,h,l),this.mask.redraw(),W(this.elementGroup,m,f,h,l),0==t||2==t){var y=0,v=2;(0==t&&c>0||2==t&&c<0)&&(y=2,v=0),this.setHandleXY(this.handles[y],m,f-l),this.setHandleXY(this.handles[v],m,f+l),this.setHandleXY(this.handles[1],m+h,f),this.setHandleXY(this.handles[3],m-h,f)}else{var w=3,S=1;(1==t&&u>0||3==t&&u<0)&&(w=1,S=3),this.setHandleXY(this.handles[w],m+h,f),this.setHandleXY(this.handles[S],m-h,f),this.setHandleXY(this.handles[0],m,f-l),this.setHandleXY(this.handles[2],m,f+l)}})),ot(this,"onGrab",(t=>e=>{this.grabbedElem=t;const i=this.getSVGPoint(e),{cx:s,cy:n}=et(this.ellipse);this.grabbedAt={x:i.x-s,y:i.y-n}})),ot(this,"onMouseMove",(t=>{const e=(t,e)=>t<0?0:t>e?e:t;if(this.grabbedElem){const i=this.getSVGPoint(t);if(this.grabbedElem===this.ellipse){const{rx:t,ry:s}=et(this.ellipse),{naturalWidth:n,naturalHeight:r}=this.env.image,o=e(i.x-this.grabbedAt.x,n-t),a=e(i.y-this.grabbedAt.y,r-s);this.setSize(o,a,t,s),this.emit("update",D(this.ellipse,this.env.image))}else{const t=this.handles.indexOf(this.grabbedElem),e=t<2?this.handles[t+2]:this.handles[t-2],s=this.handles[(t+3)%4];this.stretchCorners(t,e,s,i),this.emit("update",D(this.ellipse,this.env.image))}}})),ot(this,"onMouseUp",(()=>{this.grabbedElem=null,this.grabbedAt=null})),ot(this,"onScaleChanged",(t=>this.handles.map(this.scaleHandle))),ot(this,"updateState",(t=>{const e=$(t),i=parseFloat(e.getAttribute("cx")),s=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("rx")),r=parseFloat(e.getAttribute("ry"));this.setSize(i,s,n,r)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(n,"g"),this.ellipse=O(t),this.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.ellipse)),this.mask=new st(s.image,this.ellipse),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.ellipse);const{cx:r,cy:o,rx:a,ry:h}=et(this.ellipse);this.handles=[[r,o-h],[r+a,o],[r,o+h],[r-a,o]].map((t=>{const[e,i]=t,s=this.drawHandle(e,i);return s.addEventListener("mousedown",this.onGrab(s)),this.elementGroup.appendChild(s),s})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),_(this.ellipse,t,i.formatter),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}destroy(){this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()}}function ht(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class lt extends E{constructor(t,e,i){super(t,e,i),ht(this,"startDrawing",((t,e)=>{this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new rt(t,e,this.g,this.env)})),ht(this,"stop",(()=>{this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),ht(this,"onMouseMove",((t,e)=>this.rubberband.dragTo(t,e))),ht(this,"onMouseUp",(()=>{this.detachListeners(),this.started=!1;const{width:t,height:e}=this.rubberband.getBoundingClientRect(),i=this.config.minSelectionWidth||4,s=this.config.minSelectionHeight||4;if(t>=i&&e>=s){const{element:t}=this.rubberband;t.annotation=this.rubberband.toSelection(),this.emit("complete",t)}else this.emit("cancel");this.stop()})),ht(this,"createEditableShape",(t=>new at(t,this.g,this.config,this.env))),this.rubberband=null}get isDrawing(){return null!=this.rubberband}}function ut(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}lt.identifier="ellipse",lt.supports=t=>{const e=t.selector("SvgSelector");if(e)return e.value?.match(/^<svg.*<ellipse/g)};class ct{constructor(t,e,i){ut(this,"setPoints",(t=>{var e=t.map((t=>`L${t[0]} ${t[1]}`)).join(" ");e="M"+e.substring(1),this.outer.setAttribute("d",e),this.inner.setAttribute("d",e)})),ut(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),ut(this,"dragTo",(t=>{this.group.style.display=null,this.addPoint(t)})),ut(this,"addPoint",(t=>{this.points=[...this.points,t],this.setPoints(this.points)})),ut(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.freehand=null,this.group=null})),ut(this,"toSelection",(()=>new w(D(this.group,this.env.image)))),this.points=[t],this.env=i,this.group=document.createElementNS(n,"g"),this.freehand=document.createElementNS(n,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(n,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(n,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),e.appendChild(this.group)}get element(){return this.freehand}}function dt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const pt=t=>{const e=t.getAttribute("d").split("L"),i=[];if(e.length>0){var s=e[0].substring(1).trim().split(" ");i.push({x:parseFloat(s[0]),y:parseFloat(s[1])});for(let t=1;t<e.length;t++)s=e[t].trim().split(" "),i.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return i},bt=t=>t.querySelector(".a9s-inner").getBBox();class gt extends M{constructor(t,e,i,s){super(t,e,i,s),dt(this,"setPoints",(t=>{const e=t=>Math.round(10*t)/10;var i=t.map((t=>`L${e(t.x)} ${e(t.y)}`)).join(" ");i="M"+i.substring(1),this.shape.querySelector(".a9s-inner").setAttribute("d",i);const s=this.shape.querySelector(".a9s-outer");s.setAttribute("d",i);const{x:n,y:r,width:o,height:a}=s.getBBox();W(this.elementGroup,n,r,o,a)})),dt(this,"onGrab",(t=>e=>{this.grabbedElem=t;const i=this.getSVGPoint(e);this.grabbedAt={x:i.x,y:i.y}})),dt(this,"onMouseMove",(t=>{const e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e;if(this.grabbedElem){const i=this.getSVGPoint(t),{x:s,y:n,width:r,height:o}=bt(this.shape);if(this.grabbedElem===this.shape){const{naturalWidth:t,naturalHeight:a}=this.env.image,h=e(s,i.x-this.grabbedAt.x,t-r),l=e(n,i.y-this.grabbedAt.y,a-o),u=this.shape.querySelector(".a9s-inner"),c=pt(u).map((t=>({x:t.x+h,y:t.y+l})));this.grabbedAt=i,this.setPoints(c),this.emit("update",D(this.shape,this.env.image))}}})),dt(this,"onMouseUp",(t=>{this.grabbedElem=null,this.grabbedAt=null})),dt(this,"updateState",(t=>{const e=pt($(t));this.setPoints(e)})),dt(this,"destroy",(()=>{this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(n,"g"),this.shape=O(t),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.shape),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),_(this.shape,t,i.formatter),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape));const{x:r,y:o,width:a,height:h}=bt(this.shape);this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}}function mt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ft extends E{constructor(t,e,i){super(t,e,i),mt(this,"startDrawing",((t,e)=>{this._isDrawing=!0,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp,dblClick:this.onDblClick}),this.rubberband=new ct([t,e],this.g,this.env)})),mt(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),mt(this,"onMouseMove",((t,e)=>this.rubberband.dragTo([t,e]))),mt(this,"onMouseUp",((t,e)=>{this.onDblClick(t,e)})),mt(this,"onDblClick",((t,e)=>{this._isDrawing=!1,this.rubberband.addPoint([t,e]),this.detachListeners();const{width:i,height:s}=this.rubberband.getBoundingClientRect(),n=this.config.minSelectionWidth||4,r=this.config.minSelectionHeight||4;if(i>=n||s>=r){const t=this.rubberband.element;t.annotation=this.rubberband.toSelection(),this.emit("complete",t)}else this.emit("cancel");this.stop()})),mt(this,"createEditableShape",(t=>new gt(t,this.g,this.config,this.env))),this._isDrawing=!1}get isDrawing(){return this._isDrawing}}function yt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}ft.identifier="freehand",ft.supports=t=>{const e=t.selector("SvgSelector");if(e)return e.value.match(/^<svg.*<path*/g)&&!e.value.toUpperCase().includes("Z")};class vt extends A{constructor(t,e,i,s){super(e,i,s),yt(this,"setPoints",(t=>{var e="";for(var i of t){var s="";if(i.length>0){for(var n of i)n&&(s+=""===s?`M${n[0]},${n[1]}`:` L${n[0]},${n[1]}`);e+=s}}e+=" Z",this.outer.setAttribute("d",e),this.inner.setAttribute("d",e)})),yt(this,"close",(()=>{const t=new t(D(this.points,this.env.image));this.emit("close",{shape:this.multipolygon,multipolygon:t})})),yt(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),yt(this,"dragTo",(t=>{this.group.style.display=null,this.mousepos=t;const e=this.points[this.points.length-1].slice(0,this.points[this.points.length-1].length-1);var i=this.points.slice(0,-1);const s=[...e,t,e[0]];i.push(s),this.setPoints(i)})),yt(this,"onScaleChanged",(t=>{this.scale=t;const e=this.closeHandle.querySelector(".a9s-handle-inner"),i=this.closeHandle.querySelector(".a9s-handle-outer"),s=t*(this.config.handleRadius||6);e.setAttribute("r",s),i.setAttribute("r",s)})),yt(this,"addPoint",(t=>{if(this.points[this.points.length-1].length>0){const e=this.points[this.points.length-1].slice(0,this.points[this.points.length-1].length-1),i=e[e.length-1];Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)>4&&(this.points[this.points.length-1]=[...e,t,e[0]],this.setPoints(this.points))}else this.points[this.points.length-1]=[t,t],this.setPoints(this.points)})),yt(this,"undo",(()=>{this.pop()})),yt(this,"isClosable",(()=>this.getDistanceToStart()<6*this.scale)),yt(this,"pop",(()=>{this.points[this.points.length-1].length>2?this.points[this.points.length-1].pop():this.points.length>1&&this.points.pop(),this.setPoints(this.points)})),yt(this,"newPart",(()=>{this.points.push([])})),yt(this,"getDistanceToStart",(()=>{if(this.points[this.points.length-1].length<3)return 1/0;const t=Math.abs(this.mousepos[0]-this.points[this.points.length-1][0][0]),e=Math.abs(this.mousepos[1]-this.points[this.points.length-1][0][1]);return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))/this.scale})),yt(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.multipolygon=null,this.group=null})),yt(this,"toSelection",(()=>new w(D(this.group,this.env.image)))),this.points=[],this.points.push([t,t]),this.mousepos=t,this.env=s,this.scale=1,this.group=document.createElementNS(n,"g"),this.multipolygon=document.createElementNS(n,"g"),this.multipolygon.setAttribute("class","a9s-selection a9s-multipolygon improved-polygon"),this.rubberband=document.createElementNS(n,"polygon"),this.rubberband.setAttribute("class","a9s-rubberband"),this.closeHandle=this.drawHandle(t[0],t[1]),this.closeHandle.style.display="none",this.outer=document.createElementNS(n,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(n,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.multipolygon.appendChild(this.rubberband),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.multipolygon.appendChild(this.closeHandle),this.group.style.display="none",this.group.appendChild(this.multipolygon),e.appendChild(this.group)}get element(){return this.multipolygon}}const wt=(t,e)=>{const i=t[0],s=t[1];let n=!1;for(let t=0,r=e.length-1;t<e.length;r=t++){const o=e[t][0],a=e[t][1],h=e[r][0],l=e[r][1];a>s!=l>s&&i<(h-o)*(s-a)/(l-a)+o&&(n=!n)}return n};var St=i(72),xt=i.n(St),At=i(825),Et=i.n(At),Ct=i(659),Mt=i.n(Ct),Pt=i(56),Gt=i.n(Pt),kt=i(540),Ht=i.n(kt),Nt=i(113),jt=i.n(Nt),Lt=i(285),Tt={};function $t(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Tt.styleTagTransform=jt(),Tt.setAttributes=Gt(),Tt.insert=Mt().bind(null,"head"),Tt.domAPI=Et(),Tt.insertStyleElement=Ht(),xt()(Lt.A,Tt),Lt.A&&Lt.A.locals&&Lt.A.locals;const Ot=t=>{var e=t.split("M"),i=[];return e.forEach((function(t,e){if(t.length>0){let e=[];(t=(t=(t=(t=(t=t.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(t,i){e.push([parseFloat(t.split(",")[0]).toFixed(2).toString(),parseFloat(t.split(",")[1]).toFixed(2).toString()])})),e[0][0]!==e[e.length-1][0]&&e[0][1]!==e[e.length-1][1]&&e.push(e[0]),i.push(e)}})),i},Dt=t=>{const e=Ot(t.querySelector(".a9s-inner").attributes.d.nodeValue),i=[];for(let t of e){let e=[];for(let i of t){let t={x:parseFloat(i[0]),y:parseFloat(i[1])};e.push(t)}i.push(e)}return i},Ut=t=>{const e=$(t);(t=>{var e=$(t).getAttribute("d");Ot(e)})(t);const i=document.createElementNS(n,"g"),s=e.cloneNode(!0);s.setAttribute("class","a9s-inner");const r=e.cloneNode(!0);return r.setAttribute("class","a9s-outer"),i.appendChild(r),i.appendChild(s),i};class qt extends M{constructor(t,e,i,s){super(t,e,i,s),$t(this,"createCornerHandle",(t=>{const e=this.drawHandle(t.x,t.y);return e.addEventListener("mousedown",this.onGrab(e)),e.addEventListener("click",this.onSelectCorner(e)),this.scaleHandle(e),this.elementGroup.appendChild(e),e})),$t(this,"createMidpoint",((t,e)=>{const i=t[e],s=e===t.length-1?t[0]:t[e+1],n=(i.x+s.x)/2,r=(i.y+s.y)/2,o=this.drawMidpoint(n,r);return o.addEventListener("mousedown",this.onGrab(o)),this.shape.appendChild(o),o})),$t(this,"deleteSelected",(()=>{const t=Dt(this.shape);if(this.selected.length>0){let e=-1,i=[],s=[];for(let t of this.midpoints){let i=t.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0))),n=t.filter(((t,i)=>this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)>-1));n.forEach((t=>t.parentNode.removeChild(t))),i.length>2&&s.push(i)}for(let s of t){e+=1;let t=s.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)));t.length>2&&i.push(t)}e=-1;let n=[];for(let t of this.cornerHandles){e+=1;let i=t.filter(((t,i)=>-1!==this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0))),s=t.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)));s.length>2&&n.push(s),i.forEach((t=>t.parentNode.removeChild(t)))}this.midpoints=s,this.cornerHandles=n,this.selected=[],this.setPoints(i)}})),$t(this,"deselectCorners",(()=>this.cornerHandles.forEach((t=>a(t,"selected"))))),$t(this,"destroy",(()=>{this.container.parentNode.removeChild(this.container),this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("keydown",this.onKeyDown),super.destroy()})),$t(this,"drawMidpoint",((t,e)=>{const i=document.createElementNS(n,"circle");return i.setAttribute("class","a9s-midpoint"),i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",5*this.scale),i})),$t(this,"onAddPoint",(t=>{const e=Dt(this.shape);let i=-1,s=-1;for(let t of this.midpoints)if(s+=1,i=t.indexOf(this.grabbedElement),i>-1)break;let n=[],r=-1,o=null,a=null;for(let h of e)if(r+=1,r===s){let e=[],s=-1;for(let n of h)s+=1,e.push(n),s===i&&(e.push(t),o=this.createMidpoint(h,s-1),a=this.createMidpoint(h,s));n.push(e)}else n.push(h);const h=this.createCornerHandle(t);this.cornerHandles[s]=[...this.cornerHandles[s].slice(0,i+1),h,...this.cornerHandles[s].slice(i+1)],this.midpoints[s]=[...this.midpoints[s].slice(0,i),o,a,...this.midpoints[s].slice(i+1)],this.grabbedElement.parentNode.removeChild(this.grabbedElement),this.grabbedElement=h,this.setPoints(n)})),$t(this,"onGrab",(t=>e=>{0===e.button&&(e.stopPropagation(),this.grabbedElement=t,this.grabbedAt=this.getSVGPoint(e),this.lastMouseDown=(new Date).getTime())})),$t(this,"onKeyDown",(t=>{let{which:e}=t;46===e&&this.deleteSelected()})),$t(this,"onMoveShape",(t=>{const e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e,{x:i,y:s,width:n,height:r}=this.shape.querySelector(".a9s-inner").getBBox(),{naturalWidth:o,naturalHeight:a}=this.env.image,h=e(i,t.x-this.grabbedAt.x,o-n),l=e(s,t.y-this.grabbedAt.y,a-r);let u=[];for(let t of Dt(this.shape)){let e=t.map((t=>[t.x,t.y]));wt([this.grabbedAt.x,this.grabbedAt.y],e)?u.push(t.map((t=>({x:t.x+h,y:t.y+l})))):u.push(t)}this.grabbedAt=t,this.setPoints(u)})),$t(this,"onMoveCornerHandle",((t,e)=>{let i=-1,s=0;for(let t of this.cornerHandles){if(i=t.indexOf(this.grabbedElement),i>-1)break;s+=1}e.ctrlKey?this.selected=Array.from(new Set([...this.selected,i])):this.selected.includes(i)||(this.selected=[i]);const n=Dt(this.shape),r=this.selected.map((t=>{const e=n[s][i],r=n[s][t];return{index:t,dx:r.x-e.x,dy:r.y-e.y}}));let o=0,a=[];for(let e of Dt(this.shape)){if(o===s){let s=e.map(((e,s)=>{if(s===i)return t;if(this.selected.includes(s)){const{dx:e,dy:i}=r.find((t=>t.index===s));return{x:t.x+e,y:t.y+i}}return e}));a.push(s)}else a.push(e);o+=1}this.setPoints(a)})),$t(this,"onMouseMove",(t=>{if(this.grabbedElement){const e=this.getSVGPoint(t);this.grabbedElement===this.shape?this.onMoveShape(e):h(this.grabbedElement,"a9s-handle")?this.onMoveCornerHandle(e,t):h(this.grabbedElement,"a9s-midpoint")&&this.onAddPoint(e),this.emit("update",Yt(Dt(this.shape),this.env.image))}})),$t(this,"onMouseUp",(t=>{this.grabbedElement=null,this.grabbedAt=null})),$t(this,"onScaleChanged",(t=>{for(let t of this.cornerHandles)t.map(this.scaleHandle);for(let t of this.midpoints)t.map((t=>{t.setAttribute("r",5*this.scale)}))})),$t(this,"onSelectCorner",(t=>e=>{if(!((new Date).getTime()-this.lastMouseDown>250)){let i=-1,s=-1;for(let e of this.cornerHandles)if(i+=1,s=e.indexOf(t),s>0)break;e?.ctrlKey?this.selected.map((t=>t[0]===i&&t[1]===s)).indexOf(!0)>-1?this.selected=this.selected.filter((t=>!(t[1]===s&&t[0]===i))):this.selected=[...this.selected,[i,s]]:1===this.selected.length&&this.selected[0][1]===s&&this.selected[0][0]===i?this.selected=[]:this.selected=[[i,s]],this.setPoints(Dt(this.shape))}})),$t(this,"setPoints",(t=>{const e=Rt(t);this.shape.querySelector(".a9s-inner").setAttribute("d",e);const i=this.shape.querySelector(".a9s-outer");i.setAttribute("d",e);let s=0;for(let e of t){e.forEach(((t,e)=>{this.setHandleXY(this.cornerHandles[s][e],t.x,t.y)}));for(let t=0;t<e.length;t++){const i=e[t],n=t===e.length-1?e[0]:e[t+1],r=(i.x+n.x)/2,o=(i.y+n.y)/2,a=this.midpoints[s][t];a.setAttribute("cx",r),a.setAttribute("cy",o)}s+=1}let n=-1;for(let t of this.cornerHandles)n+=1,t.forEach(((t,e)=>{const i=this.selected.map((t=>t[0]===n&&t[1]===e)).indexOf(!0)>-1;i&&!h(t,"selectedCorner")?o(t,"selectedCorner"):!i&&h(t,"selectedCorner")&&a(t,"selectedCorner")}));const{x:r,y:l,width:u,height:c}=i.getBBox();W(this.shape,r,l,u,c)})),$t(this,"updateState",(t=>{const e=Ut(t),i=Dt(e);this.setPoints(i)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("keydown",this.onKeyDown),this.container=document.createElementNS(n,"g"),this.shape=Ut(t),this.shape.setAttribute("class","a9s-annotation editable selected improved-polygon"),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.shape);let r=Dt(this.shape);this.cornerHandles=[],this.midpoints=[];for(let t of r){let e=[];this.cornerHandles.push(t.map(((i,s)=>(e.push(this.createMidpoint(t,s)),this.createCornerHandle(i))))),this.midpoints.push(e)}this.container.appendChild(this.elementGroup),e.appendChild(this.container),_(this.shape,t,i.formatter),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape)),this.grabbedElement=null,this.grabbedAt=null,this.selected=[],this.lastMouseDown=null}get element(){return this.elementGroup}}function Xt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const Rt=t=>{const e=t=>Math.round(10*t)/10;let i="";for(let s of t){i+="M";let t=!0;for(let n of s)t?(t=!1,i+=e(n.x).toString()+","+e(n.y).toString()):i+=" L"+e(n.x).toString()+","+e(n.y).toString();i+=" Z"}return i},Yt=(t,e)=>({source:e?.src,selector:{type:"SvgSelector",value:`<svg><path d="${Rt(t)}" /></svg>`}});class Ft extends E{constructor(t,e,i){super(t,e,i),Xt(this,"startDrawing",((t,e,i,s)=>{this._isDrawing=!0,this._startOnSingleClick=i||!1,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp,dblClick:this.onDblClick}),this.rubberband=new vt([t,e],this.g,this.config,this.env),this.rubberband.on("close",(t=>{let{shape:e,selection:i}=t;e.annotation=i,this.emit("complete",e),this.stop()}))})),Xt(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),Xt(this,"undo",(()=>{this.rubberband&&this.rubberband.undo()})),Xt(this,"newPart",(()=>{this.rubberband&&this.rubberband.newPart()})),Xt(this,"onMouseMove",((t,e,i)=>{this.rubberband.dragTo([t,e])})),Xt(this,"onMouseUp",((t,e,i)=>{if(i.altKey)this.complete(t,e);else if(i.ctrlKey)this.rubberband.undo();else if(i.shiftKey&&this.rubberband.points.length>2)this.newPart();else{const{width:i,height:s}=this.rubberband.getBoundingClientRect(),n=this.config.minSelectionWidth||4,r=this.config.minSelectionHeight||4;i>=n||s>=r?this.rubberband.addPoint([t,e]):(this.emit("cancel"),this.stop())}})),Xt(this,"onScaleChanged",(t=>{this.rubberband&&this.rubberband.onScaleChanged(t)})),Xt(this,"onDblClick",((t,e)=>{this.config.completeWithDoubleClick&&this.complete(t,e)})),Xt(this,"complete",((t,e)=>{this._isDrawing=!1,this.rubberband.addPoint([t,e]);const i=this.rubberband.element;i.annotation=this.rubberband.toSelection(),this.emit("complete",i),this.stop()})),Xt(this,"createEditableShape",(t=>new qt(t,this.g,this.config,this.env))),this._isDrawing=!1,this.viewer=null,window.addEventListener("keydown",(t=>{"z"===t.key&&t.ctrlKey?this.undo():"n"!==t.key&&"p"!==t.key||this.newPart()}),!0),this._startOnSingleClick=!1}get isDrawing(){return this._isDrawing}}function Bt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Ft.identifier="multipolygon",Ft.supports=t=>{const e=t.selector("SvgSelector");if(e)return e.value?.match(/^<svg.*<path d=/g)};class Vt{constructor(t,e){Bt(this,"redraw",(()=>{this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute("x1")} ${this.line.getAttribute("y1")} ${this.line.getAttribute("x2")} ${this.line.getAttribute("y2")}z`)})),Bt(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.line=e,this.mask=document.createElementNS(n,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d",`M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute("x1")} ${this.line.getAttribute("y1")} z`)}get element(){return this.mask}}function zt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _t{constructor(t,e,i){zt(this,"setPoints",(t=>{const e=t;this.outer.setAttribute("x1",e[0]),this.inner.setAttribute("x1",e[0]),this.outer.setAttribute("y1",e[1]),this.inner.setAttribute("y1",e[1]),e.length>2&&(this.outer.setAttribute("x2",e[2]),this.inner.setAttribute("x2",e[2]),this.outer.setAttribute("y2",e[3]),this.inner.setAttribute("y2",e[3]))})),zt(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),zt(this,"dragTo",(t=>{this.group.style.display=null,this.mousepos=t;const e=[...this.points,t[0],t[1]];this.setPoints(e),this.mask.redraw()})),zt(this,"addPoint",(t=>{this.points.length<=2&&(this.points[2]=t[0],this.points[3]=t[1],this.setPoints(this.points))})),zt(this,"undo",(()=>{this.points[this.points.length-1].length>2?this.points[this.points.length-1].pop():this.points.length>1&&this.points.pop()})),zt(this,"newPart",(()=>{this.points.push([])})),zt(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.Line=null,this.group=null})),zt(this,"toSelection",(()=>new w({...D(this.group,this.env.image),renderedVia:{name:"line"}}))),this.points=t,this.env=i,this.group=document.createElementNS(n,"g"),this.Line=document.createElementNS(n,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(n,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(n,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Vt(i.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),e.appendChild(this.group)}get element(){return this.Line}}function Wt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const Kt=t=>{const e=t.querySelector(".a9s-inner");return[[e.x1.baseVal,e.y1.baseVal],[e.x2.baseVal,e.y2.baseVal]]};class It extends M{constructor(t,e,i,s){super(t,e,i,s),Wt(this,"onScaleChanged",(()=>this.handles.map(this.scaleHandle))),Wt(this,"setPoints",(t=>{var e=t[0].x,i=t[0].y,s=t[1].x,n=t[1].y;const r=this.shape.querySelector(".a9s-inner");r.setAttribute("x1",e),r.setAttribute("y1",i),r.setAttribute("x2",s),r.setAttribute("y2",n);const o=this.shape.querySelector(".a9s-outer");o.setAttribute("x1",e),o.setAttribute("y1",i),o.setAttribute("x2",s),o.setAttribute("y2",n),this.mask.redraw();const{x:a,y:h,width:l,height:u}=o.getBBox();W(this.elementGroup,a,h,l,u)})),Wt(this,"onGrab",(t=>e=>{0===e.button&&(this.grabbedElem=t,this.grabbedAt=this.getSVGPoint(e))})),Wt(this,"onMouseMove",(t=>{const e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e;if(this.grabbedElem){const i=this.getSVGPoint(t);if(this.grabbedElem===this.shape){const{x:t,y:s,width:n,height:r}=this.shape.querySelector(".a9s-inner").getBBox(),{naturalWidth:o,naturalHeight:a}=this.env.image,h=e(t,i.x-this.grabbedAt.x,o-n),l=e(s,i.y-this.grabbedAt.y,a-r),u=Kt(this.shape).map((t=>({x:t[0].value+h,y:t[1].value+l})));this.grabbedAt=i,this.setPoints(u),u.forEach(((t,e)=>this.setHandleXY(this.handles[e],t.x,t.y))),this.emit("update",D(this.shape,this.env.image))}else{const t=this.handles.indexOf(this.grabbedElem),e=Kt(this.shape).map(((e,s)=>s===t?i:{x:e[0].value,y:e[1].value}));this.setPoints(e),this.setHandleXY(this.handles[t],i.x,i.y),this.emit("update",D(this.shape,this.env.image))}}})),Wt(this,"onMouseUp",(t=>{this.grabbedElem=null,this.grabbedAt=null})),Wt(this,"updateState",(t=>{const e=$(t).getAttribute("points").split(" ").map((t=>{const[e,i]=t.split(",").map((t=>parseFloat(t.trim())));return{x:e,y:i}}));this.setPoints(e),e.forEach(((t,e)=>this.setHandleXY(this.handles[e],t.x,t.y)))})),Wt(this,"destroy",(()=>{this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(n,"g"),this.shape=O(t),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape)),this.mask=new Vt(s.image,this.shape.querySelector(".a9s-inner")),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(n,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.setAttribute("data-id",t.id),this.elementGroup.appendChild(this.shape),this.handles=Kt(this.shape).map((t=>{const e=this.drawHandle(t[0].value,t[1].value);return e.addEventListener("mousedown",this.onGrab(e)),this.elementGroup.appendChild(e),e})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),_(this.shape,t,i.formatters),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}}function Zt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Jt extends E{constructor(t,e,i){super(t,e,i),Zt(this,"startDrawing",((t,e)=>{this._isDrawing=!0,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new _t([t,e],this.g,this.env)})),Zt(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),Zt(this,"undo",(()=>{this.rubberband&&this.rubberband.undo()})),Zt(this,"newPart",(()=>{this.rubberband&&this.rubberband.newPart()})),Zt(this,"onMouseMove",((t,e)=>this.rubberband.dragTo([t,e]))),Zt(this,"onMouseUp",((t,e,i)=>{if(i.altKey)this.onDblClick(i);else if(i.ctrlKey)this.rubberband.undo();else if(2==this.rubberband.points.length)if(this.rubberband.addPoint([t,e]),this.rubberband.points[0]==this.rubberband.points[2]&&this.rubberband.points[1]==this.rubberband.points[3])this.emit("cancel"),this.stop();else{this._isDrawing=!1;const t=this.rubberband.element;t.annotation=this.rubberband.toSelection(),this.emit("complete",t),this.stop()}})),Zt(this,"createEditableShape",(t=>new It(t,this.g,this.config,this.env))),this._isDrawing=!1,document.addEventListener("keydown",(t=>{"z"==t.key&&t.ctrlKey&&this.undo(),"n"==t.key&&this.newPart()}))}get isDrawing(){return this._isDrawing}get isDrawing(){return this._isDrawing}}Jt.identifier="line",Jt.supports=t=>{const e=t.selector("SvgSelector");if(e)return e.value?.match(/^<svg.*<line/g)};class Qt{constructor(t,e){this.anchor=t,this.group=e,this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("stroke","red"),this.line.setAttribute("stroke-width",2),this.group.appendChild(this.line)}dragTo(t,e){this.line.setAttribute("x1",this.anchor.x),this.line.setAttribute("y1",this.anchor.y),this.line.setAttribute("x2",t),this.line.setAttribute("y2",e)}toGeometry(t,e){return{x1:this.anchor.x,y1:this.anchor.y,x2:t,y2:e}}destroy(){this.group.removeChild(this.line)}}class te{constructor(t,e,i){this.g=t,this.env=i,this.config=e}onPress(t,e){this.rubberband=new Qt({x:t,y:e},this.g)}onDrag(t,e){this.rubberband.dragTo(t,e)}onRelease(t,e){const i=this.rubberband.toGeometry(t,e);return this.rubberband.destroy(),{type:"arrow",geometry:i}}destroy(){this.rubberband&&this.rubberband.destroy()}}const ee=new Set(["point","circle","ellipse","freehand","line","arrow"]),ie=(t,e)=>{(e&&e.tools?e.tools.map((t=>t.toLowerCase())):ee).forEach((e=>{"point"===e&&t.addDrawingTool(L),"circle"===e&&t.addDrawingTool(J),"ellipse"===e&&t.addDrawingTool(lt),"freehand"===e&&t.addDrawingTool(ft),"multipolygon"===e&&t.addDrawingTool(Ft),"line"===e&&t.addDrawingTool(Jt),"arrow"===e&&t.addDrawingTool(te)}))}})(),s})()));