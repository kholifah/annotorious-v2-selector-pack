!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SelectorPack=e():t.SelectorPack=e()}(self,(()=>(()=>{var t={17:t=>{"use strict";t.exports=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;var r,s,n;if(Array.isArray(e)){if((r=e.length)!=i.length)return!1;for(s=r;0!=s--;)if(!t(e[s],i[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if((r=(n=Object.keys(e)).length)!==Object.keys(i).length)return!1;for(s=r;0!=s--;)if(!Object.prototype.hasOwnProperty.call(i,n[s]))return!1;for(s=r;0!=s--;){var o=n[s];if(!t(e[o],i[o]))return!1}return!0}return e!=e&&i!=i}},56:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function i(t){for(var i=-1,r=0;r<e.length;r++)if(e[r].identifier===t){i=r;break}return i}function r(t,r){for(var n={},o=[],a=0;a<t.length;a++){var h=t[a],l=r.base?h[0]+r.base:h[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var d=i(c),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var b=s(p,r);r.byIndex=a,e.splice(a,0,{identifier:c,updater:b,references:1})}o.push(c)}return o}function s(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,s){var n=r(t=t||[],s=s||{});return function(t){t=t||[];for(var o=0;o<n.length;o++){var a=i(n[o]);e[a].references--}for(var h=r(t,s),l=0;l<n.length;l++){var u=i(n[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}n=h}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},285:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(601),s=i.n(r),n=i(314),o=i.n(n)()(s());o.push([t.id,".a9s-selection.improved-polygon .a9s-rubberband{fill:hsla(0,0%,100%,.15);stroke-width:1px;stroke:rgba(0,0,0,.3)}.a9s-selection.improved-polygon .a9s-inner,.a9s-annotation.improved-polygon.editable .a9s-inner{stroke-width:2px;stroke:#fff;stroke-dasharray:5 3}.a9s-annotation.improved-polygon.editable .a9s-inner:hover{fill:rgba(0,0,0,0)}.a9s-selection.improved-polygon .a9s-outer,.a9s-annotation.improved-polygon.editable .a9s-outer{stroke-width:4px;stroke:rgba(0,0,0,.35)}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer{stroke-width:1;stroke:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner{stroke-width:2;stroke:#fff;fill:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover{fill:#fff;color:green}.selectedCorner{fill:#fff !important}.selectedCorner .a9s-handle-inner{fill:#fff !important;color:green}.a9s-annotation.improved-polygon.editable .a9s-midpoint{display:none;fill:hsla(0,0%,100%,.65);stroke-width:1;stroke:rgba(0,0,0,.65)}.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint{display:block}.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover{fill:#fff}",""]);const a=o},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",r=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),r&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),r&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,r,s,n){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);r&&o[u[0]]||(void 0!==n&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=n),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),e.push(u))}},e}},504:t=>{function e(){}e.prototype={on:function(t,e,i){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var r=this;function s(){r.off(t,s),e.apply(i,arguments)}return s._=e,this.on(t,s,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),r=0,s=i.length;r<s;r++)i[r].fn.apply(i[r].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),r=i[t],s=[];if(r&&e)for(var n=0,o=r.length;n<o;n++)r[n].fn!==e&&r[n].fn._!==e&&s.push(r[n]);return s.length?i[t]=s:delete i[t],this}},t.exports=e,t.exports.TinyEmitter=e},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},659:t=>{"use strict";var e={};t.exports=function(t,i){var r=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var s=void 0!==i.layer;s&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,s&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={id:r,exports:{}};return t[r](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0;var r={};return(()=>{"use strict";i.r(r),i.d(r,{default:()=>oe});var t=i(504),e=i.n(t);const s="http://www.w3.org/2000/svg",n=t=>{const e=t.getAttribute("class");return e?new Set(e.split(" ")):new Set},o=(t,e)=>{const i=n(t);i.add(e),t.setAttribute("class",Array.from(i).join(" "))},a=(t,e)=>{const i=n(t);i.delete(e),0===i.size?t.removeAttribute("class"):t.setAttribute("class",Array.from(i).join(" "))},h=(t,e)=>n(t).has(e);var l,u=new Uint8Array(16);function c(){if(!l&&!(l="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(u)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var p=[],b=0;b<256;++b)p.push((b+256).toString(16).substr(1));const g=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(p[t[e+0]]+p[t[e+1]]+p[t[e+2]]+p[t[e+3]]+"-"+p[t[e+4]]+p[t[e+5]]+"-"+p[t[e+6]]+p[t[e+7]]+"-"+p[t[e+8]]+p[t[e+9]]+"-"+p[t[e+10]]+p[t[e+11]]+p[t[e+12]]+p[t[e+13]]+p[t[e+14]]+p[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&d.test(t)}(i))throw TypeError("Stringified UUID is invalid");return i},m=function(t,e,i){var r=(t=t||{}).random||(t.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){i=i||0;for(var s=0;s<16;++s)e[i+s]=r[s];return e}return g(r)};var v=i(17),f=i.n(v);class y{constructor(t,e){this.underlying=t,this.opts=e}static create=t=>{const e={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:`#${m()}`,body:[]};return new y({...e,...t})};clone=(t,e)=>new y({...this.underlying,...t},{...this.opts,...e});isEqual(t){return"Annotation"===t?.type&&(this.underlying===t.underlying||!(!this.underlying.id||!t.underlying.id)&&f()(this.underlying,t.underlying))}get readOnly(){return this.opts?.readOnly}get id(){return this.underlying.id}get context(){return this.underlying["@context"]}get type(){return this.underlying.type}get motivation(){return this.underlying.motivation}get body(){return this.underlying.body}get target(){return this.underlying.target}get bodies(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}set bodies(t){this.underlying.body=t}get targets(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}selector=t=>{const{target:e}=this.underlying;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((e=>e.type===t))};get quote(){return this.selector("TextQuoteSelector")?.exact}get start(){return this.selector("TextPositionSelector")?.start}get end(){return this.selector("TextPositionSelector")?.end}}class w{constructor(t,e){this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:e||[],target:t}}clone=t=>{const e=new w;return e.underlying=JSON.parse(JSON.stringify(this.underlying)),t&&(e.underlying={...e.underlying,...t}),e};get context(){return this.underlying["@context"]}get type(){return this.underlying.type}get body(){return this.underlying.body}get target(){return this.underlying.target}get targets(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}isEqual(t){return!!t&&f()(this.underlying,t.underlying)}get bodies(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}selector=t=>{const{target:e}=this.underlying;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((e=>e.type===t))};get quote(){return this.selector("TextQuoteSelector")?.exact}get isSelection(){return!0}toAnnotation=()=>{const t=Object.assign({},this.underlying,{type:"Annotation",id:`#${m()}`});return new y(t)}}const S="An implementation is missing",x="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;class A extends(e()){constructor(t,e,i){super(),this.svg=t.closest("svg"),this.g=t,this.config=e,this.env=i,this.scale=1;const{image:r}=i;(r instanceof Element||r instanceof HTMLDocument)&&this.enableResponsive()}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}enableResponsive=()=>{window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((()=>{const t=this.svg.getBoundingClientRect(),{width:e,height:i}=this.svg.viewBox.baseVal;this.scale=Math.max(e/t.width,i/t.height),this.onScaleChanged&&this.onScaleChanged(this.scale)})),this.resizeObserver.observe(this.svg.parentNode))};getSVGPoint=t=>{const e=this.svg.createSVGPoint();if(x){const i=this.svg.getBoundingClientRect(),r=t.clientX-i.x,s=t.clientY-i.y,{left:n,top:o}=this.svg.getBoundingClientRect();return e.x=r+n,e.y=s+o,e.matrixTransform(this.g.getScreenCTM().inverse())}return e.x=t.offsetX,e.y=t.offsetY,e.matrixTransform(this.g.getCTM().inverse())};drawHandle=(t,e)=>{const i=document.createElementNS(s,"g");i.setAttribute("class","a9s-handle");const r=document.createElementNS(s,"g"),n=i=>{const r=document.createElementNS(s,"circle");return r.setAttribute("cx",t),r.setAttribute("cy",e),r.setAttribute("r",i),r.setAttribute("transform-origin",`${t} ${e}`),r},o=this.config.handleRadius||6,a=n(o);a.setAttribute("class","a9s-handle-inner");const h=n(o+1);return h.setAttribute("class","a9s-handle-outer"),r.appendChild(h),r.appendChild(a),i.appendChild(r),i};setHandleXY=(t,e,i)=>{const r=t.querySelector(".a9s-handle-inner");r.setAttribute("cx",e),r.setAttribute("cy",i),r.setAttribute("transform-origin",`${e} ${i}`);const s=t.querySelector(".a9s-handle-outer");s.setAttribute("cx",e),s.setAttribute("cy",i),s.setAttribute("transform-origin",`${e} ${i}`)};getHandleXY=t=>{const e=t.querySelector(".a9s-handle-outer");return{x:parseFloat(e.getAttribute("cx")),y:parseFloat(e.getAttribute("cy"))}};scaleHandle=t=>{const e=t.querySelector(".a9s-handle-inner"),i=t.querySelector(".a9s-handle-outer"),r=this.scale*(this.config.handleRadius||6);e.setAttribute("r",r),i.setAttribute("r",r)}}class E extends A{constructor(t,e,i){super(t,e,i),this.started=!1}attachListeners=({mouseMove:t,mouseUp:e,dblClick:i})=>{t&&(this.mouseMove=e=>{const{x:i,y:r}=this.getSVGPoint(e);this.started||(this.emit("startSelection",{x:i,y:r}),this.started=!0),t(i,r,e)},this.svg.addEventListener("mousemove",this.mouseMove)),e&&(this.mouseUp=t=>{if(0!==t.button)return;const{x:i,y:r}=this.getSVGPoint(t);e(i,r,t)},document.addEventListener("mouseup",this.mouseUp)),i&&(this.dblClick=t=>{const{x:e,y:r}=this.getSVGPoint(t);i(e,r,t)},document.addEventListener("dblclick",this.dblClick))};detachListeners=()=>{this.mouseMove&&this.svg.removeEventListener("mousemove",this.mouseMove),this.mouseUp&&document.removeEventListener("mouseup",this.mouseUp),this.dblClick&&document.removeEventListener("dblclick",this.dblClick)};start=(t,e)=>{const{x:i,y:r}=this.getSVGPoint(t),{naturalWidth:s,naturalHeight:n}=this.env.image,o=i<0?0:i>s?s:i,a=r<0?0:r>n?n:r;this.startDrawing(o,a,e,t)};get isDrawing(){throw new Error(S)}startDrawing=t=>{throw new Error(S)};createEditableShape=(t,e)=>{throw new Error(S)}}E.supports=t=>{throw new Error(S)};const C="An implementation is missing";class P extends A{constructor(t,e,i,r){super(e,i,r),this.annotation=t}get element(){throw new Error(C)}updateState=t=>{throw new Error(C)}}const M=(t,e)=>{const i=t.selector("FragmentSelector");if(i?.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){const{value:t}=i,r=t.includes(":")?t.substring(t.indexOf("=")+1,t.indexOf(":")):"pixel",s=t.includes(":")?t.substring(t.indexOf(":")+1):t.substring(t.indexOf("=")+1);let[n,o,a,h]=s.split(",").map(parseFloat);return"percent"===r.toLowerCase()&&(n=n*e.naturalWidth/100,o=o*e.naturalHeight/100,a=a*e.naturalWidth/100,h=h*e.naturalHeight/100),{x:n,y:o,w:a,h}}};function j(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function O(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?j(Object(i),!0).forEach((function(e){k(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function k(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var G=(t,e,i,r)=>O(O({},((t,e,i,r,s,n)=>"percent"===n?.toLowerCase()?((t,e,i,r,s)=>{const n=t/s.naturalWidth*100,o=e/s.naturalHeight*100,a=0/s.naturalWidth*100,h=0/s.naturalHeight*100;return{source:s.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=percent:${n},${o},${a},${h}`}}})(t,e,0,0,s):((t,e,i,r,s)=>({source:s?.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=pixel:${t},${e},0,0`}}))(t,e,0,0,s))(t,e,0,0,i,r)),{},{renderedVia:{name:"point"}});function H(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class N extends P{constructor(t,e,i,r){super(t,e,i,r),H(this,"onScaleChanged",(()=>this.scaleHandle(this.point))),H(this,"onGrab",(()=>{this.isGrabbed=!0})),H(this,"onMouseMove",(t=>{if(0===t.button&&this.isGrabbed){var{x:e,y:i}=this.getSVGPoint(t);this.setHandleXY(this.point,e,i);var r=G(e,i,this.env.image,this.config.fragmentUnit);this.emit("update",r)}})),H(this,"onMouseUp",(()=>{this.isGrabbed=!1})),H(this,"updateState",(t=>{var{x:e,y:i}=M(t,this.env.image);this.setHandleXY(this.point,e,i)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp);var{x:n,y:o}=M(t,r.image);this.container=document.createElementNS(s,"g"),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.point=this.drawHandle(n,o),this.point.addEventListener("mousedown",this.onGrab),this.elementGroup.appendChild(this.point),this.container.appendChild(this.elementGroup),e.appendChild(this.container),this.isGrabbed=!1}get element(){return this.elementGroup}destroy(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),super.destroy()}}function L(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class T extends E{constructor(t,e,i){super(t,e,i),L(this,"startDrawing",((t,e,i,r)=>{var s,n=null===(s=r.target.closest(".a9s-annotation"))||void 0===s?void 0:s.annotation;if(n&&(t=>{var e;return"point"===(null===(e=t.target.renderedVia)||void 0===e?void 0:e.name)})(n))this.emit("cancel");else{var o=this.drawHandle(t,e);this.scaleHandle(o),this.g.appendChild(o),o.annotation=new w(G(t,e,this.env.image,this.config.fragmentUnit)),this.emit("complete",o)}})),L(this,"stop",(()=>{})),L(this,"createEditableShape",(t=>new N(t,this.g,this.config,this.env)))}get isDrawing(){return!1}}T.identifier="point",T.supports=t=>!1;const D=t=>{const e=t=>{Array.from(t.attributes).forEach((e=>{e.name.startsWith("on")&&t.removeAttribute(e.name)}))},i=t.getElementsByTagName("script");return Array.from(i).reverse().forEach((t=>t.parentNode.removeChild(t))),e(t),Array.from(t.querySelectorAll("*")).forEach(e),t},U=t=>{const e=t.selector("SvgSelector");if(e){const t=new DOMParser,{value:i}=e,r=t.parseFromString(i,"image/svg+xml"),n=r.lookupPrefix(s),o=r.lookupNamespaceURI(null);return n||o?D(r).firstChild:D((t=>{const e=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",`<svg xmlns="${s}">`);return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement})(r)).firstChild}},q=t=>{const e=U(t),i=document.createElementNS(s,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");const n=e.cloneNode(!0);return n.setAttribute("class","a9s-outer"),i.appendChild(n),i.appendChild(r),i},X=(t,e)=>{const i=t.querySelector(".a9s-inner").cloneNode(!0);i.removeAttribute("class"),i.removeAttribute("xmlns");let r=i.outerHTML||(new XMLSerializer).serializeToString(i);return r=r.replace(` xmlns="${s}"`,""),{source:e?.src,selector:{type:"SvgSelector",value:`<svg>${r}</svg>`}}};var R=(t,e,i,r)=>{t.setAttribute("cx",e),t.setAttribute("cy",i),t.setAttribute("r",r)},Y=(t,e,i,r)=>{var s=t.querySelector(".a9s-inner"),n=t.querySelector(".a9s-outer");R(s,e,i,r),R(n,e,i,r)},F=t=>{var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),r:parseFloat(e.getAttribute("r"))}};function B(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class V{constructor(t,e){B(this,"redraw",(()=>{var{cx:t,cy:e,r:i}=F(this.circle),r=t+i>this.w?this.w-i:t,s=e+i>this.h?this.h-i:e+i;this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(r," ").concat(s," a ").concat(i," ").concat(i," 0 1 1 1 0"))})),B(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=e;var{cx:i,cy:r,r:n}=F(this.circle),o=i+n>this.w?this.w-n:i,a=r+n>this.h?this.h-n:r+n;this.mask=document.createElementNS(s,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(o," ").concat(a," a ").concat(n," ").concat(n," 0 1 1 1 0"))}get element(){return this.mask}}function z(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ${constructor(t,e,i,r){z(this,"dragTo",((t,e)=>{var{naturalWidth:i,naturalHeight:r}=this.env.image;this.group.style.display=null;var s=t-this.anchor[0],n=e-this.anchor[1],o=Math.max(1,Math.pow(s**2+n**2,.5)/2),a=this.anchor[0]+s/2,h=this.anchor[1]+n/2;a-o<0||a+o>i||h-o<0||h+o>r||(Y(this.circle,a,h,o),this.mask.redraw())})),z(this,"getBoundingClientRect",(()=>this.circle.getBoundingClientRect())),z(this,"toSelection",(()=>new w(X(this.group,this.env.image)))),z(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.mask=null,this.circle=null,this.group=null})),this.anchor=[t,e],this.env=r,this.group=document.createElementNS(s,"g"),this.circle=((t,e)=>{var i=document.createElementNS(s,"g"),r=document.createElementNS(s,"circle"),n=document.createElementNS(s,"circle");return n.setAttribute("class","a9s-inner"),R(n,t,e,2),r.setAttribute("class","a9s-outer"),R(r,t,e,2),i.appendChild(r),i.appendChild(n),i})(t,e),this.circle.setAttribute("class","a9s-selection"),this.mask=new V(r.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),i.appendChild(this.group)}get element(){return this.circle}}const _=/firefox/i.test(navigator.userAgent),W=(t,e,i,r,s)=>{t.setAttribute("width",r),t.setAttribute("height",s),_?(t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("transform",`translate(${e}, ${i})`)):(t.setAttribute("x",e),t.setAttribute("y",i))},K=(t,e,i)=>{if(!i)return t;const r=i.reduce(((t,i)=>{const r=i(e);if(!r)return t;if("string"==typeof r||r instanceof String)t.className=t.className?`${t.className} ${r}`:r;else if(r.nodeType===Node.ELEMENT_NODE)t.elements=t.elements?[...t.elements,r]:[r];else{const{className:e,style:i,element:s}=r;e&&(t.className=t.className?`${t.className} ${e}`:e),i&&(t.style=t.style?`${t.style} ${i}`:i),s&&(t.elements=t.elements?[...t.elements,s]:[s])}for(const e in r)r.hasOwnProperty(e)&&e.startsWith("data-")&&(t[e]=r[e]);return t}),{}),{className:n,style:a,elements:h}=r;if(n&&o(t,n),a){const e=t.querySelector(".a9s-outer"),i=t.querySelector(".a9s-inner");e&&i?(e.setAttribute("style","display:none"),i.setAttribute("style",a)):t.setAttribute("style",a)}h&&h.forEach((e=>((t,e)=>{const{x:i,y:r,width:n,height:o}=e.getBBox(),a=document.createElementNS(s,"svg");a.setAttribute("class","a9s-formatter-el"),W(a,i,r,n,o);const h=document.createElementNS(s,"g");h.appendChild(t),a.appendChild(h),e.append(a)})(e,t)));for(const e in r)r.hasOwnProperty(e)&&e.startsWith("data-")&&t.setAttribute(e,r[e])},I=(t,e,i,r,s)=>{const n=t.querySelector(".a9s-formatter-el");n&&W(n,e,i,r,s)};function Z(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class J extends P{constructor(t,e,i,r){super(t,e,i,r),Z(this,"setSize",((t,e,i)=>{Y(this.circle,t,e,i),this.mask.redraw(),I(this.elementGroup,t,e,i,i);var[r,s,n,o]=this.handles;this.setHandleXY(r,t,e-i),this.setHandleXY(s,t+i,e),this.setHandleXY(n,t,e+i),this.setHandleXY(o,t-i,e)})),Z(this,"stretchCorners",((t,e,i)=>{var r,s=this.getHandleXY(e),n=i.x,o=i.y,a=0,h=0;0==t||2==t?(n=s.x,h=o-s.y,r=Math.abs(h)/2):(o=s.y,a=n-s.x,r=Math.abs(a)/2);var l=a>0?s.x:n,u=h>0?s.y:o,c=l+Math.abs(a)/2,d=u+Math.abs(h)/2;if(Y(this.circle,c,d,r),this.mask.redraw(),I(this.elementGroup,c,d,r,r),0==t||2==t){var p=0,b=2;(0==t&&h>0||2==t&&h<0)&&(p=2,b=0),this.setHandleXY(this.handles[p],c,d-r),this.setHandleXY(this.handles[b],c,d+r),this.setHandleXY(this.handles[1],c+r,d),this.setHandleXY(this.handles[3],c-r,d)}else{var g=3,m=1;(1==t&&a>0||3==t&&a<0)&&(g=1,m=3),this.setHandleXY(this.handles[g],c+r,d),this.setHandleXY(this.handles[m],c-r,d),this.setHandleXY(this.handles[0],c,d-r),this.setHandleXY(this.handles[2],c,d+r)}})),Z(this,"onGrab",(t=>e=>{this.grabbedElem=t;var i=this.getSVGPoint(e),{cx:r,cy:s}=F(this.circle);this.grabbedAt={x:i.x-r,y:i.y-s}})),Z(this,"onMouseMove",(t=>{var e=(t,e)=>t<0?0:t>e?e:t;if(this.grabbedElem){var i=this.getSVGPoint(t);if(this.grabbedElem===this.circle){var{r}=F(this.circle),{naturalWidth:s,naturalHeight:n}=this.env.image,o=Math.max(e(i.x-this.grabbedAt.x,s-r),r),a=Math.max(e(i.y-this.grabbedAt.y,n-r),r);this.setSize(o,a,r),this.emit("update",X(this.circle,this.env.image))}else{var h=this.handles.indexOf(this.grabbedElem),l=h<2?this.handles[h+2]:this.handles[h-2];this.stretchCorners(h,l,i),this.emit("update",X(this.circle,this.env.image))}}})),Z(this,"onMouseUp",(()=>{this.grabbedElem=null,this.grabbedAt=null})),Z(this,"onScaleChanged",(t=>this.handles.map(this.scaleHandle))),Z(this,"updateState",(t=>{var e=U(t),i=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("r"));this.setSize(i,r,s)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(s,"g"),this.circle=q(t),this.circle.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.circle)),this.mask=new V(r.image,this.circle),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.circle);var{cx:n,cy:o,r:a}=F(this.circle);this.handles=[[n,o-a],[n+a,o],[n,o+a],[n-a,o]].map((t=>{var[e,i]=t,r=this.drawHandle(e,i);return r.addEventListener("mousedown",this.onGrab(r)),this.elementGroup.appendChild(r),r})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),K(this.circle,t,i.formatter),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}destroy(){this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()}}function Q(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class tt extends E{constructor(t,e,i){super(t,e,i),Q(this,"startDrawing",((t,e)=>{this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new $(t,e,this.g,this.env)})),Q(this,"stop",(()=>{this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),Q(this,"onMouseMove",((t,e)=>this.rubberband.dragTo(t,e))),Q(this,"onMouseUp",(()=>{this.detachListeners(),this.started=!1;var{width:t,height:e}=this.rubberband.getBoundingClientRect(),i=this.config.minSelectionWidth||4,r=this.config.minSelectionHeight||4;if(t>=i&&e>=r){var{element:s}=this.rubberband;s.annotation=this.rubberband.toSelection(),this.emit("complete",s)}else this.emit("cancel");this.stop()})),Q(this,"createEditableShape",(t=>new J(t,this.g,this.config,this.env))),this.rubberband=null}get isDrawing(){return null!=this.rubberband}}tt.identifier="circle",tt.supports=t=>{var e,i=t.selector("SvgSelector");if(i)return null===(e=i.value)||void 0===e?void 0:e.match(/^<svg.*<circle/g)};var et=(t,e,i,r,s)=>{t.setAttribute("cx",e),t.setAttribute("cy",i),t.setAttribute("rx",r),t.setAttribute("ry",s)},it=(t,e,i,r,s)=>{var n=t.querySelector(".a9s-inner"),o=t.querySelector(".a9s-outer");et(n,e,i,r,s),et(o,e,i,r,s)},rt=t=>{var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),rx:parseFloat(e.getAttribute("rx")),ry:parseFloat(e.getAttribute("ry"))}};function st(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class nt{constructor(t,e){st(this,"redraw",(()=>{var{cx:t,cy:e,rx:i,ry:r}=rt(this.ellipse),s=e+r;this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(t," ").concat(s," a ").concat(i," ").concat(r," 0 1 1 1 0"))})),st(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=e;var{cx:i,cy:r,rx:n,ry:o}=rt(this.ellipse),a=r+o;this.mask=document.createElementNS(s,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(i," ").concat(a," a ").concat(n," ").concat(o," 0 1 1 1 0"))}get element(){return this.mask}}function ot(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class at{constructor(t,e,i,r){ot(this,"dragTo",((t,e)=>{this.group.style.display=null;var i=t-this.anchor[0],r=e-this.anchor[1],s=i>0?this.anchor[0]+i/2:t+i/2,n=r>0?this.anchor[1]+r/2:e+r/2,o=Math.abs(i/2),a=Math.abs(r/2);it(this.ellipse,s,n,o,a),this.mask.redraw()})),ot(this,"getBoundingClientRect",(()=>this.ellipse.getBoundingClientRect())),ot(this,"toSelection",(()=>new w(X(this.group,this.env.image)))),ot(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.mask=null,this.ellipse=null,this.group=null})),this.anchor=[t,e],this.env=r,this.group=document.createElementNS(s,"g"),this.ellipse=((t,e)=>{var i=document.createElementNS(s,"g"),r=document.createElementNS(s,"ellipse"),n=document.createElementNS(s,"ellipse");return r.setAttribute("class","a9s-inner"),et(r,t,e,2,2),n.setAttribute("class","a9s-outer"),et(n,t,e,2,2),i.appendChild(n),i.appendChild(r),i})(t,e),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new nt(r.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),i.appendChild(this.group)}get element(){return this.ellipse}}function ht(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class lt extends P{constructor(t,e,i,r){super(t,e,i,r),ht(this,"setSize",((t,e,i,r)=>{it(this.ellipse,t,e,i,r),this.mask.redraw(),I(this.elementGroup,t,e,i,r);var[s,n,o,a]=this.handles;this.setHandleXY(s,t,e-r),this.setHandleXY(n,t+i,e),this.setHandleXY(o,t,e+r),this.setHandleXY(a,t-i,e)})),ht(this,"stretchCorners",((t,e,i,r)=>{var s=this.getHandleXY(e),n=this.getHandleXY(i),o=r.x,a=r.y,h=0,l=0;0==t||2==t?o=s.x:a=s.y;var u=o-s.x,c=a-s.y,d=u>0?s.x:o,p=c>0?s.y:a,b=Math.abs(u),g=Math.abs(c),m=d+b/2,v=p+g/2;if(h=b/2,l=g/2,0==t||2==t?h=Math.abs(s.x-n.x):l=Math.abs(s.y-n.y),it(this.ellipse,m,v,h,l),this.mask.redraw(),I(this.elementGroup,m,v,h,l),0==t||2==t){var f=0,y=2;(0==t&&c>0||2==t&&c<0)&&(f=2,y=0),this.setHandleXY(this.handles[f],m,v-l),this.setHandleXY(this.handles[y],m,v+l),this.setHandleXY(this.handles[1],m+h,v),this.setHandleXY(this.handles[3],m-h,v)}else{var w=3,S=1;(1==t&&u>0||3==t&&u<0)&&(w=1,S=3),this.setHandleXY(this.handles[w],m+h,v),this.setHandleXY(this.handles[S],m-h,v),this.setHandleXY(this.handles[0],m,v-l),this.setHandleXY(this.handles[2],m,v+l)}})),ht(this,"onGrab",(t=>e=>{this.grabbedElem=t;var i=this.getSVGPoint(e),{cx:r,cy:s}=rt(this.ellipse);this.grabbedAt={x:i.x-r,y:i.y-s}})),ht(this,"onMouseMove",(t=>{var e=(t,e)=>t<0?0:t>e?e:t;if(this.grabbedElem){var i=this.getSVGPoint(t);if(this.grabbedElem===this.ellipse){var{rx:r,ry:s}=rt(this.ellipse),{naturalWidth:n,naturalHeight:o}=this.env.image,a=e(i.x-this.grabbedAt.x,n-r),h=e(i.y-this.grabbedAt.y,o-s);this.setSize(a,h,r,s),this.emit("update",X(this.ellipse,this.env.image))}else{var l=this.handles.indexOf(this.grabbedElem),u=l<2?this.handles[l+2]:this.handles[l-2],c=this.handles[(l+3)%4];this.stretchCorners(l,u,c,i),this.emit("update",X(this.ellipse,this.env.image))}}})),ht(this,"onMouseUp",(()=>{this.grabbedElem=null,this.grabbedAt=null})),ht(this,"onScaleChanged",(t=>this.handles.map(this.scaleHandle))),ht(this,"updateState",(t=>{var e=U(t),i=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("rx")),n=parseFloat(e.getAttribute("ry"));this.setSize(i,r,s,n)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(s,"g"),this.ellipse=q(t),this.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.ellipse)),this.mask=new nt(r.image,this.ellipse),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.ellipse);var{cx:n,cy:o,rx:a,ry:h}=rt(this.ellipse);this.handles=[[n,o-h],[n+a,o],[n,o+h],[n-a,o]].map((t=>{var[e,i]=t,r=this.drawHandle(e,i);return r.addEventListener("mousedown",this.onGrab(r)),this.elementGroup.appendChild(r),r})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),K(this.ellipse,t,i.formatter),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}destroy(){this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()}}function ut(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ct extends E{constructor(t,e,i){super(t,e,i),ut(this,"startDrawing",((t,e)=>{this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new at(t,e,this.g,this.env)})),ut(this,"stop",(()=>{this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),ut(this,"onMouseMove",((t,e)=>this.rubberband.dragTo(t,e))),ut(this,"onMouseUp",(()=>{this.detachListeners(),this.started=!1;var{width:t,height:e}=this.rubberband.getBoundingClientRect(),i=this.config.minSelectionWidth||4,r=this.config.minSelectionHeight||4;if(t>=i&&e>=r){var{element:s}=this.rubberband;s.annotation=this.rubberband.toSelection(),this.emit("complete",s)}else this.emit("cancel");this.stop()})),ut(this,"createEditableShape",(t=>new lt(t,this.g,this.config,this.env))),this.rubberband=null}get isDrawing(){return null!=this.rubberband}}function dt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}ct.identifier="ellipse",ct.supports=t=>{var e,i=t.selector("SvgSelector");if(i)return null===(e=i.value)||void 0===e?void 0:e.match(/^<svg.*<ellipse/g)};class pt{constructor(t,e,i){dt(this,"setPoints",(t=>{var e=t.map((t=>"L".concat(t[0]," ").concat(t[1]))).join(" ");e="M"+e.substring(1),this.outer.setAttribute("d",e),this.inner.setAttribute("d",e)})),dt(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),dt(this,"dragTo",(t=>{this.group.style.display=null,this.addPoint(t)})),dt(this,"addPoint",(t=>{this.points=[...this.points,t],this.setPoints(this.points)})),dt(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.freehand=null,this.group=null})),dt(this,"toSelection",(()=>new w(X(this.group,this.env.image)))),this.points=[t],this.env=i,this.group=document.createElementNS(s,"g"),this.freehand=document.createElementNS(s,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(s,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(s,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),e.appendChild(this.group)}get element(){return this.freehand}}function bt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var gt=t=>{var e=t.getAttribute("d").split("L"),i=[];if(e.length>0){var r=e[0].substring(1).trim().split(" ");i.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var s=1;s<e.length;s++)r=e[s].trim().split(" "),i.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return i},mt=t=>t.querySelector(".a9s-inner").getBBox();class vt extends P{constructor(t,e,i,r){super(t,e,i,r),bt(this,"setPoints",(t=>{var e=t=>Math.round(10*t)/10,i=t.map((t=>"L".concat(e(t.x)," ").concat(e(t.y)))).join(" ");i="M"+i.substring(1),this.shape.querySelector(".a9s-inner").setAttribute("d",i);var r=this.shape.querySelector(".a9s-outer");r.setAttribute("d",i);var{x:s,y:n,width:o,height:a}=r.getBBox();I(this.elementGroup,s,n,o,a)})),bt(this,"onGrab",(t=>e=>{this.grabbedElem=t;var i=this.getSVGPoint(e);this.grabbedAt={x:i.x,y:i.y}})),bt(this,"onMouseMove",(t=>{var e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e;if(this.grabbedElem){var i=this.getSVGPoint(t),{x:r,y:s,width:n,height:o}=mt(this.shape);if(this.grabbedElem===this.shape){var{naturalWidth:a,naturalHeight:h}=this.env.image,l=e(r,i.x-this.grabbedAt.x,a-n),u=e(s,i.y-this.grabbedAt.y,h-o),c=this.shape.querySelector(".a9s-inner"),d=gt(c).map((t=>({x:t.x+l,y:t.y+u})));this.grabbedAt=i,this.setPoints(d),this.emit("update",X(this.shape,this.env.image))}}})),bt(this,"onMouseUp",(t=>{this.grabbedElem=null,this.grabbedAt=null})),bt(this,"updateState",(t=>{var e=gt(U(t));this.setPoints(e)})),bt(this,"destroy",(()=>{this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(s,"g"),this.shape=q(t),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.shape),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),K(this.shape,t,i.formatter),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape));var{x:n,y:o,width:a,height:h}=mt(this.shape);this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}}function ft(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class yt extends E{constructor(t,e,i){super(t,e,i),ft(this,"startDrawing",((t,e)=>{this._isDrawing=!0,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp,dblClick:this.onDblClick}),this.rubberband=new pt([t,e],this.g,this.env)})),ft(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),ft(this,"onMouseMove",((t,e)=>this.rubberband.dragTo([t,e]))),ft(this,"onMouseUp",((t,e)=>{this.onDblClick(t,e)})),ft(this,"onDblClick",((t,e)=>{this._isDrawing=!1,this.rubberband.addPoint([t,e]),this.detachListeners();var{width:i,height:r}=this.rubberband.getBoundingClientRect(),s=this.config.minSelectionWidth||4,n=this.config.minSelectionHeight||4;if(i>=s||r>=n){var o=this.rubberband.element;o.annotation=this.rubberband.toSelection(),this.emit("complete",o)}else this.emit("cancel");this.stop()})),ft(this,"createEditableShape",(t=>new vt(t,this.g,this.config,this.env))),this._isDrawing=!1}get isDrawing(){return this._isDrawing}}function wt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}yt.identifier="freehand",yt.supports=t=>{var e=t.selector("SvgSelector");if(e)return e.value.match(/^<svg.*<path*/g)&&!e.value.toUpperCase().includes("Z")};class St extends A{constructor(t,e,i,r){super(e,i,r),wt(this,"setPoints",(t=>{var e="";for(var i of t){var r="";if(i.length>0){for(var s of i)s&&(r+=""===r?"M".concat(s[0],",").concat(s[1]):" L".concat(s[0],",").concat(s[1]));e+=r}}e+=" Z",this.outer.setAttribute("d",e),this.inner.setAttribute("d",e)})),wt(this,"close",(()=>{var t=new t(X(this.points,this.env.image));this.emit("close",{shape:this.multipolygon,multipolygon:t})})),wt(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),wt(this,"dragTo",(t=>{this.group.style.display=null,this.mousepos=t;var e=this.points[this.points.length-1].slice(0,this.points[this.points.length-1].length-1),i=this.points.slice(0,-1),r=[...e,t,e[0]];i.push(r),this.setPoints(i)})),wt(this,"onScaleChanged",(t=>{this.scale=t;var e=this.closeHandle.querySelector(".a9s-handle-inner"),i=this.closeHandle.querySelector(".a9s-handle-outer"),r=t*(this.config.handleRadius||6);e.setAttribute("r",r),i.setAttribute("r",r)})),wt(this,"addPoint",(t=>{if(this.points[this.points.length-1].length>0){var e=this.points[this.points.length-1].slice(0,this.points[this.points.length-1].length-1),i=e[e.length-1];Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)>4&&(this.points[this.points.length-1]=[...e,t,e[0]],this.setPoints(this.points))}else this.points[this.points.length-1]=[t,t],this.setPoints(this.points)})),wt(this,"undo",(()=>{this.pop()})),wt(this,"isClosable",(()=>this.getDistanceToStart()<6*this.scale)),wt(this,"pop",(()=>{this.points[this.points.length-1].length>2?this.points[this.points.length-1].pop():this.points.length>1&&this.points.pop(),this.setPoints(this.points)})),wt(this,"newPart",(()=>{this.points.push([])})),wt(this,"getDistanceToStart",(()=>{if(this.points[this.points.length-1].length<3)return 1/0;var t=Math.abs(this.mousepos[0]-this.points[this.points.length-1][0][0]),e=Math.abs(this.mousepos[1]-this.points[this.points.length-1][0][1]);return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))/this.scale})),wt(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.multipolygon=null,this.group=null})),wt(this,"toSelection",(()=>new w(X(this.group,this.env.image)))),this.points=[],this.points.push([t,t]),this.mousepos=t,this.env=r,this.scale=1,this.group=document.createElementNS(s,"g"),this.multipolygon=document.createElementNS(s,"g"),this.multipolygon.setAttribute("class","a9s-selection a9s-multipolygon improved-polygon"),this.rubberband=document.createElementNS(s,"polygon"),this.rubberband.setAttribute("class","a9s-rubberband"),this.closeHandle=this.drawHandle(t[0],t[1]),this.closeHandle.style.display="none",this.outer=document.createElementNS(s,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(s,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.multipolygon.appendChild(this.rubberband),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.multipolygon.appendChild(this.closeHandle),this.group.style.display="none",this.group.appendChild(this.multipolygon),e.appendChild(this.group)}get element(){return this.multipolygon}}const xt=(t,e)=>{const i=t[0],r=t[1];let s=!1;for(let t=0,n=e.length-1;t<e.length;n=t++){const o=e[t][0],a=e[t][1],h=e[n][0],l=e[n][1];a>r!=l>r&&i<(h-o)*(r-a)/(l-a)+o&&(s=!s)}return s};var At=i(72),Et=i.n(At),Ct=i(825),Pt=i.n(Ct),Mt=i(659),jt=i.n(Mt),Ot=i(56),kt=i.n(Ot),Gt=i(540),Ht=i.n(Gt),Nt=i(113),Lt=i.n(Nt),Tt=i(285),Dt={};function Ut(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Dt.styleTagTransform=Lt(),Dt.setAttributes=kt(),Dt.insert=jt().bind(null,"head"),Dt.domAPI=Pt(),Dt.insertStyleElement=Ht(),Et()(Tt.A,Dt),Tt.A&&Tt.A.locals&&Tt.A.locals;var qt=t=>{var e=t.split("M"),i=[];return e.forEach((function(t,e){if(t.length>0){var r=[];(t=(t=(t=(t=(t=t.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(t,e){r.push([parseFloat(t.split(",")[0]).toFixed(2).toString(),parseFloat(t.split(",")[1]).toFixed(2).toString()])})),r[0][0]!==r[r.length-1][0]&&r[0][1]!==r[r.length-1][1]&&r.push(r[0]),i.push(r)}})),i},Xt=t=>{var e=qt(t.querySelector(".a9s-inner").attributes.d.nodeValue),i=[];for(var r of e){var s=[];for(var n of r){var o={x:parseFloat(n[0]),y:parseFloat(n[1])};s.push(o)}i.push(s)}return i},Rt=t=>{var e=U(t);(t=>{var e=U(t).getAttribute("d");qt(e)})(t);var i=document.createElementNS(s,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");var n=e.cloneNode(!0);return n.setAttribute("class","a9s-outer"),i.appendChild(n),i.appendChild(r),i};class Yt extends P{constructor(t,e,i,r){var n;super(t,e,i,r),n=this,Ut(this,"createCornerHandle",(t=>{var e=this.drawHandle(t.x,t.y);return e.addEventListener("mousedown",this.onGrab(e)),e.addEventListener("click",this.onSelectCorner(e)),this.scaleHandle(e),this.elementGroup.appendChild(e),e})),Ut(this,"createMidpoint",((t,e)=>{var i=t[e],r=e===t.length-1?t[0]:t[e+1],s=(i.x+r.x)/2,n=(i.y+r.y)/2,o=this.drawMidpoint(s,n);return o.addEventListener("mousedown",this.onGrab(o)),this.shape.appendChild(o),o})),Ut(this,"deleteSelected",(()=>{var t=Xt(this.shape);if(this.selected.length>0){var e=-1,i=[],r=[];for(var s of this.midpoints){var n=s.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0))),o=s.filter(((t,i)=>this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)>-1));o.forEach((t=>t.parentNode.removeChild(t))),n.length>2&&r.push(n)}for(var a of t){e+=1;var h=a.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)));h.length>2&&i.push(h)}e=-1;var l=[];for(var u of this.cornerHandles){e+=1;var c=u.filter(((t,i)=>-1!==this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0))),d=u.filter(((t,i)=>-1===this.selected.map((t=>t[0]===e&&t[1]===i)).indexOf(!0)));d.length>2&&l.push(d),c.forEach((t=>t.parentNode.removeChild(t)))}this.midpoints=r,this.cornerHandles=l,this.selected=[],this.setPoints(i)}})),Ut(this,"deselectCorners",(()=>this.cornerHandles.forEach((t=>a(t,"selected"))))),Ut(this,"destroy",(()=>{this.container.parentNode.removeChild(this.container),this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("keydown",this.onKeyDown),super.destroy()})),Ut(this,"drawMidpoint",((t,e)=>{var i=document.createElementNS(s,"circle");return i.setAttribute("class","a9s-midpoint"),i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",5*this.scale),i})),Ut(this,"onAddPoint",(t=>{var e=Xt(this.shape),i=-1,r=-1;for(var s of this.midpoints)if(r+=1,(i=s.indexOf(this.grabbedElement))>-1)break;var n=[],o=-1,a=null,h=null;for(var l of e)if((o+=1)===r){var u=[],c=-1;for(var d of l)c+=1,u.push(d),c===i&&(u.push(t),a=this.createMidpoint(l,c-1),h=this.createMidpoint(l,c));n.push(u)}else n.push(l);var p=this.createCornerHandle(t);this.cornerHandles[r]=[...this.cornerHandles[r].slice(0,i+1),p,...this.cornerHandles[r].slice(i+1)],this.midpoints[r]=[...this.midpoints[r].slice(0,i),a,h,...this.midpoints[r].slice(i+1)],this.grabbedElement.parentNode.removeChild(this.grabbedElement),this.grabbedElement=p,this.setPoints(n)})),Ut(this,"onGrab",(t=>e=>{0===e.button&&(e.stopPropagation(),this.grabbedElement=t,this.grabbedAt=this.getSVGPoint(e),this.lastMouseDown=(new Date).getTime())})),Ut(this,"onKeyDown",(t=>{var{which:e}=t;46===e&&this.deleteSelected()})),Ut(this,"onMoveShape",(t=>{var e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e,{x:i,y:r,width:s,height:n}=this.shape.querySelector(".a9s-inner").getBBox(),{naturalWidth:o,naturalHeight:a}=this.env.image,h=e(i,t.x-this.grabbedAt.x,o-s),l=e(r,t.y-this.grabbedAt.y,a-n),u=[];for(var c of Xt(this.shape)){var d=c.map((t=>[t.x,t.y]));xt([this.grabbedAt.x,this.grabbedAt.y],d)?u.push(c.map((t=>({x:t.x+h,y:t.y+l})))):u.push(c)}this.grabbedAt=t,this.setPoints(u)})),Ut(this,"onMoveCornerHandle",((t,e)=>{var i=-1,r=0;for(var s of this.cornerHandles){if((i=s.indexOf(this.grabbedElement))>-1)break;r+=1}e.ctrlKey?this.selected=Array.from(new Set([...this.selected,i])):this.selected.includes(i)||(this.selected=[i]);var n=Xt(this.shape),o=this.selected.map((t=>{var e=n[r][i],s=n[r][t];return{index:t,dx:s.x-e.x,dy:s.y-e.y}})),a=0,h=[];for(var l of Xt(this.shape)){if(a===r){var u=l.map(((e,r)=>{if(r===i)return t;if(this.selected.includes(r)){var{dx:s,dy:n}=o.find((t=>t.index===r));return{x:t.x+s,y:t.y+n}}return e}));h.push(u)}else h.push(l);a+=1}this.setPoints(h)})),Ut(this,"onMouseMove",(t=>{if(this.grabbedElement){var e=this.getSVGPoint(t);this.grabbedElement===this.shape?this.onMoveShape(e):h(this.grabbedElement,"a9s-handle")?this.onMoveCornerHandle(e,t):h(this.grabbedElement,"a9s-midpoint")&&this.onAddPoint(e),this.emit("update",Vt(Xt(this.shape),this.env.image))}})),Ut(this,"onMouseUp",(t=>{this.grabbedElement=null,this.grabbedAt=null})),Ut(this,"onScaleChanged",(t=>{for(var e of this.cornerHandles)e.map(this.scaleHandle);for(var i of this.midpoints)i.map((t=>{t.setAttribute("r",5*this.scale)}))})),Ut(this,"onSelectCorner",(t=>e=>{if(!((new Date).getTime()-this.lastMouseDown>250)){var i=-1,r=-1;for(var s of this.cornerHandles)if(i+=1,(r=s.indexOf(t))>0)break;null!=e&&e.ctrlKey?this.selected.map((t=>t[0]===i&&t[1]===r)).indexOf(!0)>-1?this.selected=this.selected.filter((t=>!(t[1]===r&&t[0]===i))):this.selected=[...this.selected,[i,r]]:1===this.selected.length&&this.selected[0][1]===r&&this.selected[0][0]===i?this.selected=[]:this.selected=[[i,r]],this.setPoints(Xt(this.shape))}})),Ut(this,"setPoints",(t=>{var e=Bt(t);this.shape.querySelector(".a9s-inner").setAttribute("d",e);var i=this.shape.querySelector(".a9s-outer");i.setAttribute("d",e);var r=0;for(var s of t){s.forEach(((t,e)=>{this.setHandleXY(this.cornerHandles[r][e],t.x,t.y)}));for(var n=0;n<s.length;n++){var l=s[n],u=n===s.length-1?s[0]:s[n+1],c=(l.x+u.x)/2,d=(l.y+u.y)/2,p=this.midpoints[r][n];p.setAttribute("cx",c),p.setAttribute("cy",d)}r+=1}var b=-1;for(var g of this.cornerHandles)b+=1,g.forEach(((t,e)=>{var i=this.selected.map((t=>t[0]===b&&t[1]===e)).indexOf(!0)>-1;i&&!h(t,"selectedCorner")?o(t,"selectedCorner"):!i&&h(t,"selectedCorner")&&a(t,"selectedCorner")}));var{x:m,y:v,width:f,height:y}=i.getBBox();I(this.shape,m,v,f,y)})),Ut(this,"updateState",(t=>{var e=Rt(t),i=Xt(e);this.setPoints(i)})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("keydown",this.onKeyDown),this.container=document.createElementNS(s,"g"),this.shape=Rt(t),this.shape.setAttribute("class","a9s-annotation editable selected improved-polygon"),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.appendChild(this.shape);var l=Xt(this.shape);this.cornerHandles=[],this.midpoints=[];var u=function(t){var e=[];n.cornerHandles.push(t.map(((i,r)=>(e.push(n.createMidpoint(t,r)),n.createCornerHandle(i))))),n.midpoints.push(e)};for(var c of l)u(c);this.container.appendChild(this.elementGroup),e.appendChild(this.container),K(this.shape,t,i.formatter),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape)),this.grabbedElement=null,this.grabbedAt=null,this.selected=[],this.lastMouseDown=null}get element(){return this.elementGroup}}function Ft(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Bt=t=>{var e=t=>Math.round(10*t)/10,i="";for(var r of t){i+="M";var s=!0;for(var n of r)s?(s=!1,i+=e(n.x).toString()+","+e(n.y).toString()):i+=" L"+e(n.x).toString()+","+e(n.y).toString();i+=" Z"}return i},Vt=(t,e)=>({source:null==e?void 0:e.src,selector:{type:"SvgSelector",value:'<svg><path d="'.concat(Bt(t),'" /></svg>')}});class zt extends E{constructor(t,e,i){super(t,e,i),Ft(this,"startDrawing",((t,e,i,r)=>{this._isDrawing=!0,this._startOnSingleClick=i||!1,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp,dblClick:this.onDblClick}),this.rubberband=new St([t,e],this.g,this.config,this.env),this.rubberband.on("close",(t=>{var{shape:e,selection:i}=t;e.annotation=i,this.emit("complete",e),this.stop()}))})),Ft(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),Ft(this,"undo",(()=>{this.rubberband&&this.rubberband.undo()})),Ft(this,"newPart",(()=>{this.rubberband&&this.rubberband.newPart()})),Ft(this,"onMouseMove",((t,e,i)=>{this.rubberband.dragTo([t,e])})),Ft(this,"onMouseUp",((t,e,i)=>{if(i.altKey)this.complete(t,e);else if(i.ctrlKey)this.rubberband.undo();else if(i.shiftKey&&this.rubberband.points.length>2)this.newPart();else{var{width:r,height:s}=this.rubberband.getBoundingClientRect(),n=this.config.minSelectionWidth||4,o=this.config.minSelectionHeight||4;r>=n||s>=o?this.rubberband.addPoint([t,e]):(this.emit("cancel"),this.stop())}})),Ft(this,"onScaleChanged",(t=>{this.rubberband&&this.rubberband.onScaleChanged(t)})),Ft(this,"onDblClick",((t,e)=>{this.config.completeWithDoubleClick&&this.complete(t,e)})),Ft(this,"complete",((t,e)=>{this._isDrawing=!1,this.rubberband.addPoint([t,e]);var i=this.rubberband.element;i.annotation=this.rubberband.toSelection(),this.emit("complete",i),this.stop()})),Ft(this,"createEditableShape",(t=>new Yt(t,this.g,this.config,this.env))),this._isDrawing=!1,this.viewer=null,window.addEventListener("keydown",(t=>{"z"===t.key&&t.ctrlKey?this.undo():"n"!==t.key&&"p"!==t.key||this.newPart()}),!0),this._startOnSingleClick=!1}get isDrawing(){return this._isDrawing}}function $t(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}zt.identifier="multipolygon",zt.supports=t=>{var e,i=t.selector("SvgSelector");if(i)return null===(e=i.value)||void 0===e?void 0:e.match(/^<svg.*<path d=/g)};class _t{constructor(t,e){$t(this,"redraw",(()=>{this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," ").concat(this.line.getAttribute("x2")," ").concat(this.line.getAttribute("y2"),"z"))})),$t(this,"destroy",(()=>this.mask.parentNode.removeChild(this.mask))),this.w=t.naturalWidth,this.h=t.naturalHeight,this.line=e,this.mask=document.createElementNS(s,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))}get element(){return this.mask}}function Wt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Kt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Wt(Object(i),!0).forEach((function(e){It(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Wt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function It(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Zt{constructor(t,e,i){It(this,"setPoints",(t=>{var e=t;this.outer.setAttribute("x1",e[0]),this.inner.setAttribute("x1",e[0]),this.outer.setAttribute("y1",e[1]),this.inner.setAttribute("y1",e[1]),e.length>2&&(this.outer.setAttribute("x2",e[2]),this.inner.setAttribute("x2",e[2]),this.outer.setAttribute("y2",e[3]),this.inner.setAttribute("y2",e[3]))})),It(this,"getBoundingClientRect",(()=>this.outer.getBoundingClientRect())),It(this,"dragTo",(t=>{this.group.style.display=null,this.mousepos=t;var e=[...this.points,t[0],t[1]];this.setPoints(e),this.mask.redraw()})),It(this,"addPoint",(t=>{this.points.length<=2&&(this.points[2]=t[0],this.points[3]=t[1],this.setPoints(this.points))})),It(this,"undo",(()=>{this.points[this.points.length-1].length>2?this.points[this.points.length-1].pop():this.points.length>1&&this.points.pop()})),It(this,"newPart",(()=>{this.points.push([])})),It(this,"destroy",(()=>{this.group.parentNode.removeChild(this.group),this.Line=null,this.group=null})),It(this,"toSelection",(()=>new w(Kt(Kt({},X(this.group,this.env.image)),{},{renderedVia:{name:"line"}})))),this.points=t,this.env=i,this.group=document.createElementNS(s,"g"),this.Line=document.createElementNS(s,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(s,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(s,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new _t(i.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),e.appendChild(this.group)}get element(){return this.Line}}function Jt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Qt=t=>{var e=t.querySelector(".a9s-inner");return[[e.x1.baseVal,e.y1.baseVal],[e.x2.baseVal,e.y2.baseVal]]};class te extends P{constructor(t,e,i,r){super(t,e,i,r),Jt(this,"onScaleChanged",(()=>this.handles.map(this.scaleHandle))),Jt(this,"setPoints",(t=>{var e=t[0].x,i=t[0].y,r=t[1].x,s=t[1].y,n=this.shape.querySelector(".a9s-inner");n.setAttribute("x1",e),n.setAttribute("y1",i),n.setAttribute("x2",r),n.setAttribute("y2",s);var o=this.shape.querySelector(".a9s-outer");o.setAttribute("x1",e),o.setAttribute("y1",i),o.setAttribute("x2",r),o.setAttribute("y2",s),this.mask.redraw();var{x:a,y:h,width:l,height:u}=o.getBBox();I(this.elementGroup,a,h,l,u)})),Jt(this,"onGrab",(t=>e=>{0===e.button&&(this.grabbedElem=t,this.grabbedAt=this.getSVGPoint(e))})),Jt(this,"onMouseMove",(t=>{var e=(t,e,i)=>t+e<0?-t:t+e>i?i-t:e;if(this.grabbedElem){var i=this.getSVGPoint(t);if(this.grabbedElem===this.shape){var{x:r,y:s,width:n,height:o}=this.shape.querySelector(".a9s-inner").getBBox(),{naturalWidth:a,naturalHeight:h}=this.env.image,l=e(r,i.x-this.grabbedAt.x,a-n),u=e(s,i.y-this.grabbedAt.y,h-o),c=Qt(this.shape).map((t=>({x:t[0].value+l,y:t[1].value+u})));this.grabbedAt=i,this.setPoints(c),c.forEach(((t,e)=>this.setHandleXY(this.handles[e],t.x,t.y))),this.emit("update",X(this.shape,this.env.image))}else{var d=this.handles.indexOf(this.grabbedElem),p=Qt(this.shape).map(((t,e)=>e===d?i:{x:t[0].value,y:t[1].value}));this.setPoints(p),this.setHandleXY(this.handles[d],i.x,i.y),this.emit("update",X(this.shape,this.env.image))}}})),Jt(this,"onMouseUp",(t=>{this.grabbedElem=null,this.grabbedAt=null})),Jt(this,"updateState",(t=>{var e=U(t).getAttribute("points").split(" ").map((t=>{var[e,i]=t.split(",").map((t=>parseFloat(t.trim())));return{x:e,y:i}}));this.setPoints(e),e.forEach(((t,e)=>this.setHandleXY(this.handles[e],t.x,t.y)))})),Jt(this,"destroy",(()=>{this.containerGroup.parentNode.removeChild(this.containerGroup),super.destroy()})),this.svg.addEventListener("mousemove",this.onMouseMove),this.svg.addEventListener("mouseup",this.onMouseUp),this.containerGroup=document.createElementNS(s,"g"),this.shape=q(t),this.shape.querySelector(".a9s-inner").addEventListener("mousedown",this.onGrab(this.shape)),this.mask=new _t(r.image,this.shape.querySelector(".a9s-inner")),this.containerGroup.appendChild(this.mask.element),this.elementGroup=document.createElementNS(s,"g"),this.elementGroup.setAttribute("class","a9s-annotation editable selected"),this.elementGroup.setAttribute("data-id",t.id),this.elementGroup.appendChild(this.shape),this.handles=Qt(this.shape).map((t=>{var e=this.drawHandle(t[0].value,t[1].value);return e.addEventListener("mousedown",this.onGrab(e)),this.elementGroup.appendChild(e),e})),this.containerGroup.appendChild(this.elementGroup),e.appendChild(this.containerGroup),K(this.shape,t,i.formatters),this.grabbedElem=null,this.grabbedAt=null}get element(){return this.elementGroup}}function ee(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ie extends E{constructor(t,e,i){super(t,e,i),ee(this,"startDrawing",((t,e)=>{this._isDrawing=!0,this.attachListeners({mouseMove:this.onMouseMove,mouseUp:this.onMouseUp}),this.rubberband=new Zt([t,e],this.g,this.env)})),ee(this,"stop",(()=>{this.detachListeners(),this._isDrawing=!1,this.rubberband&&(this.rubberband.destroy(),this.rubberband=null)})),ee(this,"undo",(()=>{this.rubberband&&this.rubberband.undo()})),ee(this,"newPart",(()=>{this.rubberband&&this.rubberband.newPart()})),ee(this,"onMouseMove",((t,e)=>this.rubberband.dragTo([t,e]))),ee(this,"onMouseUp",((t,e,i)=>{if(i.altKey)this.onDblClick(i);else if(i.ctrlKey)this.rubberband.undo();else if(2==this.rubberband.points.length)if(this.rubberband.addPoint([t,e]),this.rubberband.points[0]==this.rubberband.points[2]&&this.rubberband.points[1]==this.rubberband.points[3])this.emit("cancel"),this.stop();else{this._isDrawing=!1;var r=this.rubberband.element;r.annotation=this.rubberband.toSelection(),this.emit("complete",r),this.stop()}})),ee(this,"createEditableShape",(t=>new te(t,this.g,this.config,this.env))),this._isDrawing=!1,document.addEventListener("keydown",(t=>{"z"==t.key&&t.ctrlKey&&this.undo(),"n"==t.key&&this.newPart()}))}get isDrawing(){return this._isDrawing}get isDrawing(){return this._isDrawing}}ie.identifier="line",ie.supports=t=>{var e,i=t.selector("SvgSelector");if(i)return null===(e=i.value)||void 0===e?void 0:e.match(/^<svg.*<line/g)};class re{constructor(t,e){this.anchor=t,this.group=e,this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("stroke","red"),this.line.setAttribute("stroke-width",2),this.group.appendChild(this.line)}dragTo(t,e){this.line.setAttribute("x1",this.anchor.x),this.line.setAttribute("y1",this.anchor.y),this.line.setAttribute("x2",t),this.line.setAttribute("y2",e)}toGeometry(t,e){return{x1:this.anchor.x,y1:this.anchor.y,x2:t,y2:e}}destroy(){this.group.removeChild(this.line)}}class se{constructor(t,e,i){this.g=t,this.env=i,this.config=e}onPress(t,e){this.rubberband=new re({x:t,y:e},this.g)}onDrag(t,e){this.rubberband.dragTo(t,e)}onRelease(t,e){var i=this.rubberband.toGeometry(t,e);return this.rubberband.destroy(),{type:"arrow",geometry:i}}destroy(){this.rubberband&&this.rubberband.destroy()}}var ne=new Set(["point","circle","ellipse","freehand","line","arrow"]);const oe=(t,e)=>{(e&&e.tools?e.tools.map((t=>t.toLowerCase())):ne).forEach((e=>{"point"===e&&t.addDrawingTool(T),"circle"===e&&t.addDrawingTool(tt),"ellipse"===e&&t.addDrawingTool(ct),"freehand"===e&&t.addDrawingTool(yt),"multipolygon"===e&&t.addDrawingTool(zt),"line"===e&&t.addDrawingTool(ie),"arrow"===e&&t.addDrawingTool(se)}))}})(),r})()));